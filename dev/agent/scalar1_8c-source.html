---
section: development
---
<!-- CONTENT START -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>scalar1.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor=white>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>scalar1.c</h1><div class="fragment"><pre>00001 <font class="preprocessor">#include &lt;net-snmp/net-snmp-config.h&gt;</font>
00002 
00003 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00004 <font class="preprocessor">#if HAVE_STRING_H</font>
00005 <font class="preprocessor"></font><font class="preprocessor">#include &lt;string.h&gt;</font>
00006 <font class="preprocessor">#else</font>
00007 <font class="preprocessor"></font><font class="preprocessor">#include &lt;strings.h&gt;</font>
00008 <font class="preprocessor">#endif</font>
00009 <font class="preprocessor"></font>
00010 <font class="preprocessor">#include &lt;net-snmp/net-snmp-includes.h&gt;</font>
00011 <font class="preprocessor">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</font>
00012 
00013 <font class="preprocessor">#include &lt;net-snmp/agent/scalar.h&gt;</font>
00014 <font class="preprocessor">#include &lt;net-snmp/agent/serialize.h&gt;</font>
00015 <font class="preprocessor">#include &lt;net-snmp/agent/read_only.h&gt;</font>
00016 
00017 <font class="preprocessor">#if HAVE_DMALLOC_H</font>
00018 <font class="preprocessor"></font><font class="preprocessor">#include &lt;dmalloc.h&gt;</font>
00019 <font class="preprocessor">#endif</font>
00020 <font class="preprocessor"></font>
00025 netsnmp_mib_handler *
00026 netsnmp_get_scalar_handler(<font class="keywordtype">void</font>)
00027 {
00028     <font class="keywordflow">return</font> netsnmp_create_handler(<font class="stringliteral">"scalar"</font>,
00029                                   netsnmp_scalar_helper_handler);
00030 }
00031 
00032 <font class="keywordtype">int</font>
00033 netsnmp_register_scalar(netsnmp_handler_registration *reginfo)
00034 {
00035     netsnmp_inject_handler(reginfo, netsnmp_get_scalar_handler());
00036     <font class="keywordflow">return</font> netsnmp_register_serialize(reginfo);
00037 }
00038 
00039 <font class="keywordtype">int</font>
00040 netsnmp_register_read_only_scalar(netsnmp_handler_registration *reginfo)
00041 {
00042     netsnmp_inject_handler(reginfo, netsnmp_get_scalar_handler());
00043     netsnmp_inject_handler(reginfo, netsnmp_get_read_only_handler());
00044     <font class="keywordflow">return</font> netsnmp_register_serialize(reginfo);
00045 }
00046 
00047 
00048 <font class="keywordtype">int</font>
00049 netsnmp_scalar_helper_handler(netsnmp_mib_handler *handler,
00050                                 netsnmp_handler_registration *reginfo,
00051                                 netsnmp_agent_request_info *reqinfo,
00052                                 netsnmp_request_info *requests)
00053 {
00054 
00055     netsnmp_variable_list *var = requests-&gt;requestvb;
00056 
00057     <font class="keywordtype">int</font>             ret, cmp;
00058     <font class="keywordtype">int</font>             namelen;
00059     oid             subid;
00060     <font class="keywordtype">int</font>             nosuch_err;
00061 
00062     oid             build_space[MAX_OID_LEN];
00063 
00064     DEBUGMSGTL((<font class="stringliteral">"helper:scalar"</font>, <font class="stringliteral">"Got request:\n"</font>));
00065     namelen = SNMP_MIN(requests-&gt;requestvb-&gt;name_length,
00066                        reginfo-&gt;rootoid_len);
00067     cmp = snmp_oid_compare(requests-&gt;requestvb-&gt;name, namelen,
00068                            reginfo-&gt;rootoid, reginfo-&gt;rootoid_len);
00069 
00070     namelen = requests-&gt;requestvb-&gt;name_length;
00071     subid   = requests-&gt;requestvb-&gt;name[namelen-1];
00072 
00073     DEBUGMSGTL((<font class="stringliteral">"helper:scalar"</font>, <font class="stringliteral">"  oid:"</font>, cmp));
00074     DEBUGMSGOID((<font class="stringliteral">"helper:scalar"</font>, var-&gt;name, var-&gt;name_length));
00075     DEBUGMSG((<font class="stringliteral">"helper:scalar"</font>, <font class="stringliteral">"\n"</font>));
00076 
00077     nosuch_err = SNMP_ERR_NOCREATION;
00078     <font class="keywordflow">switch</font> (reqinfo-&gt;mode) {
00079     <font class="keywordflow">case</font> MODE_GET:
00080         nosuch_err = SNMP_NOSUCHINSTANCE;
00081         <font class="comment">/* Fall-through */</font>
00082 
00083     <font class="keywordflow">case</font> MODE_SET_RESERVE1:
00084     <font class="keywordflow">case</font> MODE_SET_RESERVE2:
00085     <font class="keywordflow">case</font> MODE_SET_ACTION:
00086     <font class="keywordflow">case</font> MODE_SET_COMMIT:
00087     <font class="keywordflow">case</font> MODE_SET_UNDO:
00088     <font class="keywordflow">case</font> MODE_SET_FREE:
00089         <font class="keywordflow">if</font> (cmp != 0) {
00090             netsnmp_set_request_error(reqinfo, requests,
00091                                       SNMP_NOSUCHOBJECT);
00092             <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
00093         } <font class="keywordflow">else</font> {
00094             <font class="keywordflow">if</font> (( namelen != reginfo-&gt;rootoid_len+1) ||
00095                 ( subid   != 0 )) {
00096                 netsnmp_set_request_error(reqinfo, requests, nosuch_err);
00097                 <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
00098             } <font class="keywordflow">else</font> {
00099                 <font class="keywordflow">return</font> netsnmp_call_next_handler(handler, reginfo, reqinfo,
00100                                              requests);
00101             }
00102         }
00103         <font class="keywordflow">break</font>;
00104 
00105     <font class="keywordflow">case</font> MODE_GETNEXT:
00106         <font class="keywordflow">if</font> (cmp &lt; 0 ||
00107            (cmp == 0 &amp;&amp; namelen &lt;= reginfo-&gt;rootoid_len) ||
00108            (cmp == 0 &amp;&amp; namelen == reginfo-&gt;rootoid_len+1 &amp;&amp;
00109             subid == 0 &amp;&amp; requests-&gt;inclusive)) {
00110             reqinfo-&gt;mode = MODE_GET;
00111             memcpy(build_space, reginfo-&gt;rootoid,
00112                    reginfo-&gt;rootoid_len * <font class="keyword">sizeof</font>(oid));
00113             build_space[reginfo-&gt;rootoid_len] = 0;  <font class="comment">/* add the instance subid */</font>
00114 
00115             snmp_set_var_objid(requests-&gt;requestvb, build_space,
00116                                reginfo-&gt;rootoid_len+1);
00117             ret =
00118                 netsnmp_call_next_handler(handler, reginfo, reqinfo,
00119                                           requests);
00120             reqinfo-&gt;mode = MODE_GETNEXT;
00121             <font class="keywordflow">return</font> ret;
00122         } <font class="keywordflow">else</font> {
00123             <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
00124         }
00125         <font class="keywordflow">break</font>;
00126     }
00127     <font class="comment">/*</font>
00128 <font class="comment">     * got here only if illegal mode found </font>
00129 <font class="comment">     */</font>
00130     <font class="keywordflow">return</font> SNMP_ERR_GENERR;
00131 }
00132 
00133 <font class="comment">/*</font>
00134 <font class="comment"> * @} </font>
00135 <font class="comment"> */</font>
</pre></div><hr><address><small><!--#include virtual="/sfbutton.html" --><br>Generated on
 Mon Apr 28 23:28:48 2003 for net-snmp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
<!--#include virtual="/sfbutton.html" -->
<!-- CONTENT END -->