---
section: development
---
<!-- CONTENT START -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>snmp_agent.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>snmp_agent.c File Reference</h1><code>#include &lt;<a class="el" href="config_8h-source.html">config.h</a>&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;limits.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;sys/select.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;dmalloc.h&gt;</code><br>
<code>#include "mibincl.h"</code><br>
<code>#include "snmp_client.h"</code><br>
<code>#include "snmp_alarm.h"</code><br>
<code>#include "<a class="el" href="snmpd_8h-source.html">snmpd.h</a>"</code><br>
<code>#include "mibgroup/struct.h"</code><br>
<code>#include "mibgroup/util_funcs.h"</code><br>
<code>#include "<a class="el" href="mib__module__config_8h-source.html">mib_module_config.h</a>"</code><br>
<code>#include "default_store.h"</code><br>
<code>#include "system.h"</code><br>
<code>#include "<a class="el" href="ds__agent_8h-source.html">ds_agent.h</a>"</code><br>
<code>#include "<a class="el" href="snmp__agent_8h-source.html">snmp_agent.h</a>"</code><br>
<code>#include "vacm.h"</code><br>
<code>#include "snmp_transport.h"</code><br>
<code>#include "snmpUDPDomain.h"</code><br>
<code>#include "snmpCallbackDomain.h"</code><br>
<code>#include "snmpUnixDomain.h"</code><br>
<code>#include "snmpTCPDomain.h"</code><br>
<code>#include "agentx/protocol.h"</code><br>
<code>#include "agentx/master.h"</code><br>

<p>
<a href="snmp__agent_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="struct__agent__nsap.html">_agent_nsap</a></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="structaddrCache.html">addrCache</a></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="structagent__set__cache__s.html">agent_set_cache_s</a></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="structsaved__var__data.html">saved_var_data</a></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td nowrap align=right valign=top>#define&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a0">SNMP_NEED_REQUEST_LIST</a></td></tr>
<tr><td nowrap align=right valign=top>#define&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td nowrap align=right valign=top>typedef <a class="el" href="struct__agent__nsap.html">_agent_nsap</a>&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a5">agent_nsap</a></td></tr>
<tr><td nowrap align=right valign=top>typedef <a class="el" href="structagent__set__cache__s.html">agent_set_cache_s</a>&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a9">agent_set_cache</a></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a14">snmp_check_packet</a> (struct snmp_session *, struct _snmp_transport *, void *, int)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a15">snmp_check_parse</a> (struct snmp_session *, struct snmp_pdu *, int)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a16">delete_subtree_cache</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a17">handle_pdu</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a18">wrap_up_request</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, int status)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a19">check_delayed_request</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a20">handle_getnext_loop</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>repeatedly calls getnext handlers looking for an answer till all requests are satisified.</em> <a href="#a20">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a21">handle_set_loop</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="snmp__agent_8c.html#a9">agent_set_cache</a> *&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a22">save_set_cache</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a23">get_set_cache</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a24">getNextSessID</a> ()</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a25">agent_check_and_process</a> (int block)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a26">snmp_addrcache_initialise</a> (void)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a27">snmp_addrcache_age</a> (void)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a28">snmp_check_packet</a> (struct snmp_session *session, snmp_transport *transport, void *transport_data, int transport_data_length)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a29">register_agent_nsap</a> (snmp_transport *t)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a30">deregister_agent_nsap</a> (int handle)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a31">init_master_agent</a> (void)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a32">init_agent_snmp_session</a> (struct snmp_session *session, struct snmp_pdu *pdu)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a33">free_agent_snmp_session</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a34">check_for_delegated</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a35">dump_sess_list</a> (void)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a36">remove_and_free_agent_snmp_session</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a37">free_agent_snmp_session_by_session</a> (struct snmp_session *sess, void(*free_request)(struct request_list *))</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a38">handle_snmp_packet</a> (int op, struct snmp_session *session, int reqid, struct snmp_pdu *pdu, void *magic)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>handles an incoming SNMP packet into the agent.</em> <a href="#a38">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a39">add_varbind_to_cache</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, int vbcount, struct variable_list *varbind_ptr, struct <a class="el" href="structsubtree.html">subtree</a> *tp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a40">check_acm</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, u_char type)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a41">create_subtree_cache</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a42">reassign_requests</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a43">delete_request_infos</a> (<a class="el" href="snmp__agent_8h.html#a18">request_info</a> *reqlist)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a44">check_requests_status</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *requests)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a45">check_all_requests_status</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a46">handle_var_requests</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a47">check_outstanding_agent_requests</a> (int status)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a48">check_transaction_id</a> (int transaction_id)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Decide if the requested transaction_id is still being processed within the agent.</em> <a href="#a48">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a49">check_getnext_results</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>returns 1 if there are valid GETNEXT requests left.</em> <a href="#a49">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a50">handle_set</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a51">set_request_error</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *reqinfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *request, int error_value)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a52">set_mode_request_error</a> (int mode, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *request, int error_value)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a53">set_all_requests_error</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *reqinfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *requests, int error_value)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a54">marker_uptime</a> (marker_t pm)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a55">timeval_uptime</a> (struct timeval *tv)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a56">get_agent_uptime</a> (void)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a57">agent_add_list_data</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *ari, data_list *node)</td></tr>
<tr><td nowrap align=right valign=top>void *&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a58">agent_get_list_data</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *ari, const char *name)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a59">free_agent_data_set</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *ari)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a60">free_agent_data_sets</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *ari)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a61">free_agent_request_info</a> (<a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *ari)</td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a3">lastAddrAge</a> = 0</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a4">log_addresses</a> = 0</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a8">agent_delegated_list</a> = NULL</td></tr>
<tr><td nowrap align=right valign=top>snmp_session *&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a11">main_session</a> = NULL</td></tr>
<tr><td nowrap align=right valign=top>timeval&nbsp;</td><td valign=bottom><a class="el" href="snmp__agent_8c.html#a12">starttime</a></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a name="a1" doxytag="snmp_agent.c::SNMP_ADDRCACHE_SIZE"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SNMP_ADDRCACHE_SIZE&nbsp;&nbsp;&nbsp;10
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00112">112</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<a name="a0" doxytag="snmp_agent.c::SNMP_NEED_REQUEST_LIST"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SNMP_NEED_REQUEST_LIST
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00072">72</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a name="a5" doxytag="snmp_agent.c::agent_nsap"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="struct__agent__nsap.html">_agent_nsap</a>  agent_nsap
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a name="a9" doxytag="snmp_agent.c::agent_set_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="structagent__set__cache__s.html">agent_set_cache_s</a>  agent_set_cache
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a39" doxytag="snmp_agent.c::add_varbind_to_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int add_varbind_to_cache </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>asp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>vbcount</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct variable_list *&nbsp;</td>
          <td class="mdname">&nbsp; <em>varbind_ptr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structsubtree.html">subtree</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>tp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01125">1125</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01242">create_subtree_cache</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01308">reassign_requests</a>().
<p>
<div class="fragment"><pre>01126                                                                             {
01127     <a class="code" href="structrequest__info__s.html">request_info</a> *request;
01128     <font class="keywordtype">int</font> cacheid;
01129     <a class="code" href="structtree__cache__s.html">tree_cache</a> *tmpc;
01130 
01131     <font class="keywordflow">if</font> (tp == NULL) {
01132         <font class="comment">/* no appropriate registration found */</font>
01133         <font class="comment">/* make up the response ourselves */</font>
01134         <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command) {
01135             <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
01136             <font class="keywordflow">case</font> SNMP_MSG_GETBULK:
01137                 varbind_ptr-&gt;type = SNMP_ENDOFMIBVIEW;
01138                 <font class="keywordflow">break</font>;
01139                     
01140             <font class="keywordflow">case</font> SNMP_MSG_SET:
01141                 <font class="keywordflow">return</font> SNMP_NOSUCHOBJECT;
01142 
01143             <font class="keywordflow">case</font> SNMP_MSG_GET:
01144                 varbind_ptr-&gt;type = SNMP_NOSUCHOBJECT;
01145                 <font class="keywordflow">break</font>;
01146 
01147             <font class="keywordflow">default</font>:
01148                 <font class="keywordflow">return</font> SNMPERR_GENERR; <font class="comment">/* shouldn't get here */</font>
01149         }
01150     } <font class="keywordflow">else</font> {
01151         <font class="keywordflow">if</font> (!<a class="code" href="snmp__agent_8h.html#a15">MODE_IS_SET</a>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command))
01152             varbind_ptr-&gt;type = ASN_NULL;
01153 
01154         <font class="comment">/* malloc the request structure */</font>
01155         request = SNMP_MALLOC_TYPEDEF(<a class="code" href="structrequest__info__s.html">request_info</a>);
01156         <font class="keywordflow">if</font> (request == NULL)
01157             <font class="keywordflow">return</font> SNMP_ERR_GENERR;
01158         request-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a> = vbcount;
01159 
01160         <font class="comment">/* place them in a cache */</font>
01161         <font class="keywordflow">if</font> (tp-&gt;<a class="code" href="structsubtree.html#m20">cacheid</a> &gt; -1 &amp;&amp; tp-&gt;<a class="code" href="structsubtree.html#m20">cacheid</a> &lt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a> &amp;&amp;
01162             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[tp-&gt;<a class="code" href="structsubtree.html#m20">cacheid</a>]-&gt;subtree == tp) {
01163             <font class="comment">/* we have already added a request to this tree</font>
01164                    pointer before */
01165                                         cacheid = tp-&gt;<a class="code" href="structsubtree.html#m20">cacheid</a>;
01166 
01167         } <font class="keywordflow">else</font> {
01168             cacheid = ++(asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>);
01169             <font class="comment">/* new slot needed */</font>
01170             <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a> &gt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>) {
01171                 <font class="comment">/* exapand cache array */</font>
01172                 <font class="comment">/* WWW: non-linear expansion needed (with cap) */</font>
01173                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a> = (asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a> + 16);
01174                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> = realloc(asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>,
01175                                          <font class="keyword">sizeof</font>(<a class="code" href="structtree__cache__s.html">tree_cache</a> *) *
01176                                          asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>);
01177                 <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> == NULL)
01178                     <font class="keywordflow">return</font> SNMP_ERR_GENERR;
01179             }
01180             tmpc = (<a class="code" href="structtree__cache__s.html">tree_cache</a> *) calloc(1, <font class="keyword">sizeof</font>(<a class="code" href="structtree__cache__s.html">tree_cache</a>));
01181             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid] = tmpc;
01182             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;subtree = tp;
01183             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;requests_begin = request;
01184             tp-&gt;<a class="code" href="structsubtree.html#m20">cacheid</a> = cacheid;
01185         }
01186 
01187         <font class="comment">/* if this is a search type, get the ending range oid as well */</font>
01188         <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command == SNMP_MSG_GETNEXT ||
01189             asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command == SNMP_MSG_GETBULK) {
01190             request-&gt;<a class="code" href="structrequest__info__s.html#m2">range_end</a>     = tp-&gt;<a class="code" href="structsubtree.html#m4">end</a>;
01191             request-&gt;<a class="code" href="structrequest__info__s.html#m3">range_end_len</a> = tp-&gt;<a class="code" href="structsubtree.html#m5">end_len</a>;
01192         }
01193 
01194         <font class="comment">/* link into chain */</font>
01195         <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;requests_end)
01196             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;requests_end-&gt;next = request;
01197         request-&gt;<a class="code" href="structrequest__info__s.html#m9">prev</a> =
01198             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;requests_end;
01199         asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[cacheid]-&gt;requests_end = request;
01200 
01201         <font class="comment">/* add the given request to the list of requests they need</font>
01202                to handle results for */
01203         request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a> = varbind_ptr;
01204     }
01205     <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01206 }
</pre></div>    </td>
  </tr>
</table>
<a name="a57" doxytag="snmp_agent.c::agent_add_list_data"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void agent_add_list_data </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>agent</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>data_list *&nbsp;</td>
          <td class="mdname">&nbsp; <em>node</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01939">1939</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01940 {
01941   <font class="keywordflow">if</font> (ari) {
01942     <font class="keywordflow">if</font> (ari-&gt;agent_data)
01943       add_list_data(&amp;ari-&gt;agent_data, node);
01944     <font class="keywordflow">else</font>
01945       ari-&gt;agent_data = node;
01946   }
01947 }
</pre></div>    </td>
  </tr>
</table>
<a name="a25" doxytag="snmp_agent.c::agent_check_and_process"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int agent_check_and_process </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname1">&nbsp; <em>block</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00256">256</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00256                                    {
00257   <font class="keywordtype">int</font> numfds;
00258   fd_set fdset;
00259   <font class="keyword">struct </font>timeval timeout = { LONG_MAX, 0 }, *tvp = &amp;timeout;
00260   <font class="keywordtype">int</font> count;
00261   <font class="keywordtype">int</font> fakeblock=0;
00262   
00263   numfds = 0;
00264   <a class="code" href="snmpd_8c.html#a4">FD_ZERO</a>(&amp;fdset);
00265   snmp_select_info(&amp;numfds, &amp;fdset, tvp, &amp;fakeblock);
00266   <font class="keywordflow">if</font> (block != 0 &amp;&amp; fakeblock != 0) {
00267     <font class="comment">/*  There are no alarms registered, and the caller asked for blocking, so</font>
00268         let select() block forever.  */
00269 
00270     tvp = NULL;
00271   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (block != 0 &amp;&amp; fakeblock == 0) {
00272     <font class="comment">/*  The caller asked for blocking, but there is an alarm due sooner than</font>
00273         LONG_MAX seconds from now, so use the modified timeout returned by
00274         snmp_select_info as the timeout for select().  */
00275 
00276   } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (block == 0) {
00277     <font class="comment">/*  The caller does not want us to block at all.  */</font>
00278 
00279     tvp-&gt;tv_sec  = 0;
00280     tvp-&gt;tv_usec = 0;
00281   }
00282 
00283   count = select(numfds, &amp;fdset, 0, 0, tvp);
00284 
00285   <font class="keywordflow">if</font> (count &gt; 0) {
00286     <font class="comment">/* packets found, process them */</font>
00287     snmp_read(&amp;fdset);
00288   } <font class="keywordflow">else</font> <font class="keywordflow">switch</font>(count) {
00289     <font class="keywordflow">case</font> 0:
00290       snmp_timeout();
00291       <font class="keywordflow">break</font>;
00292     <font class="keywordflow">case</font> -1:
00293       <font class="keywordflow">if</font> (errno != EINTR) {
00294         snmp_log_perror(<font class="stringliteral">"select"</font>);
00295       }
00296       <font class="keywordflow">return</font> -1;
00297     <font class="keywordflow">default</font>:
00298       snmp_log(LOG_ERR, <font class="stringliteral">"select returned %d\n"</font>, count);
00299       <font class="keywordflow">return</font> -1;
00300   }  <font class="comment">/* endif -- count&gt;0 */</font>
00301 
00302   <font class="comment">/*  Run requested alarms.  */</font>
00303   run_alarms();
00304 
00305   <font class="keywordflow">return</font> count;
00306 }
</pre></div>    </td>
  </tr>
</table>
<a name="a58" doxytag="snmp_agent.c::agent_get_list_data"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void* agent_get_list_data </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>agent</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>name</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01950">1950</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01951 {
01952   <font class="keywordflow">if</font> (ari)
01953     <font class="keywordflow">return</font> get_list_data(ari-&gt;agent_data,name);
01954   <font class="keywordflow">return</font> NULL;
01955 }
</pre></div>    </td>
  </tr>
</table>
<a name="a40" doxytag="snmp_agent.c::check_acm"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_acm </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>asp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_char&nbsp;</td>
          <td class="mdname">&nbsp; <em>type</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01214">1214</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01597">handle_getnext_loop</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>().
<p>
<div class="fragment"><pre>01214                                                         {
01215     <font class="keywordtype">int</font> view;
01216     <font class="keywordtype">int</font> i;
01217     <a class="code" href="structrequest__info__s.html">request_info</a> *request;
01218     <font class="keywordtype">int</font> ret = 0;
01219     <font class="keyword">struct </font>variable_list *vb;
01220     
01221     <font class="keywordflow">for</font>(i = 0; i &lt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>; i++) {
01222         <font class="keywordflow">for</font>(request = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;requests_begin;
01223             request; request = request-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>) {
01224             <font class="comment">/* for each request, run it through in_a_view() */</font>
01225             vb = request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>;
01226             <font class="keywordflow">if</font> (vb-&gt;type == ASN_NULL) <font class="comment">/* not yet processed */</font>
01227                 <font class="keywordflow">continue</font>;
01228             view = <a class="code" href="agent__registry_8h.html#a49">in_a_view</a>(vb-&gt;name, &amp;vb-&gt;name_length, asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>, vb-&gt;type);
01229 
01230             <font class="comment">/* if a ACM error occurs, mark it as type passed in */</font>
01231             <font class="keywordflow">if</font> (view != VACM_SUCCESS) {
01232                 ret++;
01233                 snmp_set_var_typed_value(vb, type, NULL, 0);
01234             }
01235         }
01236     }
01237     <font class="keywordflow">return</font> ret;
01238 }
</pre></div>    </td>
  </tr>
</table>
<a name="a45" doxytag="snmp_agent.c::check_all_requests_status"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_all_requests_status </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01396">1396</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01501">check_delayed_request</a>().
<p>
<div class="fragment"><pre>01396                                                            {
01397     <font class="keywordtype">int</font> i;
01398     <font class="keywordflow">for</font>(i = 0; i &lt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>; i++) {
01399         <a class="code" href="snmp__agent_8c.html#a44">check_requests_status</a>(asp, asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;requests_begin);
01400     }
01401     <font class="keywordflow">return</font> asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
01402 }
</pre></div>    </td>
  </tr>
</table>
<a name="a19" doxytag="snmp_agent.c::check_delayed_request"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_delayed_request </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01501">1501</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01455">check_outstanding_agent_requests</a>().
<p>
<div class="fragment"><pre>01501                                                        {
01502     <font class="keywordtype">int</font> status = SNMP_ERR_NOERROR;
01503     
01504     <a class="code" href="snmp__agent_8c.html#a45">check_all_requests_status</a>(asp); <font class="comment">/* update the asp-&gt;status */</font>
01505 
01506     <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>) {
01507         <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
01508             <a class="code" href="snmp__agent_8c.html#a20">handle_getnext_loop</a>(asp);
01509             <font class="keywordflow">break</font>;
01510 
01511         <font class="keywordflow">case</font> SNMP_MSG_GETBULK:
01512             <font class="comment">/* WWW */</font>
01513             <font class="keywordflow">break</font>;
01514 
01515         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a8">MODE_SET_BEGIN</a>:
01516         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>:
01517         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a10">MODE_SET_RESERVE2</a>:
01518         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a11">MODE_SET_ACTION</a>:
01519         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a12">MODE_SET_COMMIT</a>:
01520         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a13">MODE_SET_FREE</a>:
01521         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a14">MODE_SET_UNDO</a>:
01522             <a class="code" href="snmp__agent_8c.html#a21">handle_set_loop</a>(asp);
01523             <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_SUCCESS &amp;&amp;
01524                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_FAILURE) {
01525 
01526                 <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))<font class="keyword"> </font>{
01527                     <font class="comment">/* add to delegated request chain */</font>
01528                     <font class="keywordflow">if</font> (!asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>)
01529                         asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = status;
01530                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a> = <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a>;
01531                     <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a> = asp;
01532                 }
01533 
01534                 <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01535             }
01536             <font class="keywordflow">break</font>;
01537 
01538         <font class="keywordflow">default</font>:
01539             <font class="keywordflow">break</font>;
01540     }
01541 
01542     <font class="comment">/* if we don't have anything outstanding (delegated), wrap up */</font>
01543     <font class="keywordflow">if</font> (!<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))
01544         <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8c.html#a18">wrap_up_request</a>(asp, status);
01545 
01546     <font class="keywordflow">return</font> 1;
01547 }
</pre></div>    </td>
  </tr>
</table>
<a name="a34" doxytag="snmp_agent.c::check_for_delegated"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_for_delegated </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00858">858</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01501">check_delayed_request</a>(), <a class="el" href="snmp__agent_8c-source.html#l01455">check_outstanding_agent_requests</a>(), <a class="el" href="snmp__agent_8c-source.html#l01597">handle_getnext_loop</a>(), <a class="el" href="snmp__agent_8c-source.html#l01726">handle_set_loop</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01030">handle_snmp_packet</a>().
<p>
<div class="fragment"><pre>00858                                                     {
00859     <font class="keywordtype">int</font> i;
00860     <a class="code" href="structrequest__info__s.html">request_info</a> *request;
00861     
00862     <font class="keywordflow">for</font>(i = 0; i &lt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>; i++) {
00863         <font class="keywordflow">for</font>(request = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;requests_begin; request;
00864             request = request-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>) {
00865             <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m4">delegated</a>)
00866                 <font class="keywordflow">return</font> 1;
00867         }
00868     }
00869     <font class="keywordflow">return</font> 0;
00870 }
</pre></div>    </td>
  </tr>
</table>
<a name="a49" doxytag="snmp_agent.c::check_getnext_results"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_getnext_results </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
returns 1 if there are valid GETNEXT requests left.
<p>
Returns 0 if not. 
<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01551">1551</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01597">handle_getnext_loop</a>().
<p>
<div class="fragment"><pre>01551                                                        {
01552     <font class="comment">/* get old info */</font>
01553     <a class="code" href="structtree__cache__s.html">tree_cache</a> **old_treecache = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>;
01554     <font class="keywordtype">int</font> old_treecache_num = asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>;
01555     <font class="keywordtype">int</font> count = 0;
01556     <font class="keywordtype">int</font> i;
01557     <a class="code" href="structrequest__info__s.html">request_info</a> *request;
01558     
01559     <font class="keywordflow">for</font>(i = 0; i &lt;= old_treecache_num; i++) {
01560         <font class="keywordflow">for</font>(request = old_treecache[i]-&gt;<a class="code" href="structtree__cache__s.html#m1">requests_begin</a>; request;
01561             request = request-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>) {
01562 
01563             <font class="comment">/* out of range? */</font>
01564             <font class="keywordflow">if</font> (snmp_oid_compare(request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
01565                                  request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length,
01566                                  request-&gt;<a class="code" href="structrequest__info__s.html#m2">range_end</a>,
01567                                  request-&gt;<a class="code" href="structrequest__info__s.html#m3">range_end_len</a>) &gt; 0)<font class="keyword"> </font>{
01568                 <font class="comment">/* ack, it's beyond the accepted end of range. */</font>
01569                 <font class="comment">/* fix it by setting the oid to the end of range oid instead */</font>
01570                 DEBUGMSGTL((<font class="stringliteral">"check_getnext_results"</font>,
01571                             <font class="stringliteral">"request response %d out of range"</font>, request-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a>));
01572                 
01573                 snmp_set_var_objid(request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>,
01574                                    request-&gt;<a class="code" href="structrequest__info__s.html#m2">range_end</a>, request-&gt;<a class="code" href="structrequest__info__s.html#m3">range_end_len</a>);
01575                 snmp_set_var_typed_value(request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>, ASN_NULL,
01576                                          NULL, 0);
01577             }
01578 
01579             <font class="comment">/* mark any existent requests with illegal results as NULL */</font>
01580             <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type == SNMP_ENDOFMIBVIEW) {
01581                 <font class="comment">/* illegal response from a subagent.  Change it back to NULL */</font>
01582                 request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type = ASN_NULL;
01583             }
01584                             
01585             <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type == ASN_NULL ||
01586                 request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type == ASN_PRIV_RETRY)
01587                 count++;
01588         }
01589     }
01590     <font class="keywordflow">return</font> count;
01591 }
</pre></div>    </td>
  </tr>
</table>
<a name="a47" doxytag="snmp_agent.c::check_outstanding_agent_requests"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void check_outstanding_agent_requests </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname1">&nbsp; <em>status</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01455">1455</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01455                                              {
01456     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, *prev_asp = NULL, *next_asp = NULL;
01457 
01458     <font class="keywordflow">for</font>(asp = <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a>; asp; prev_asp = asp, asp = next_asp) {
01459         next_asp = asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>; <font class="comment">/* save in case we clean up asp */</font>
01460         <font class="keywordflow">if</font> (!<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))<font class="keyword"> </font>{
01461 
01462             <font class="comment">/* we're done with this one, remove from queue */</font>
01463             <font class="keywordflow">if</font> (prev_asp != NULL)
01464                 prev_asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
01465             <font class="keywordflow">else</font>
01466                 <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
01467 
01468             <font class="comment">/* continue processing or finish up */</font>
01469             <a class="code" href="snmp__agent_8c.html#a19">check_delayed_request</a>(asp);
01470         }
01471     }
01472 }
</pre></div>    </td>
  </tr>
</table>
<a name="a44" doxytag="snmp_agent.c::check_requests_status"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_requests_status </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>asp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>requests</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01381">1381</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01396">check_all_requests_status</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01405">handle_var_requests</a>().
<p>
<div class="fragment"><pre>01381                                                                                {
01382     <font class="comment">/* find any errors marked in the requests */</font>
01383     <font class="keywordflow">while</font>(requests) {
01384         <font class="keywordflow">if</font> (requests-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> != SNMP_ERR_NOERROR &amp;&amp;
01385             (asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a> == 0 ||
01386              requests-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a> &lt; asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a>)) {
01387             asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a> = requests-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a>;
01388             asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = requests-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a>;
01389         }
01390         requests = requests-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>;
01391     }
01392     <font class="keywordflow">return</font> asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
01393 }
</pre></div>    </td>
  </tr>
</table>
<a name="a48" doxytag="snmp_agent.c::check_transaction_id"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_transaction_id </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname1">&nbsp; <em>transaction_id</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Decide if the requested transaction_id is still being processed within the agent.
<p>
This is used to validate whether a delayed cache (containing possibly freed pointers) is still usable.
<p>
returns SNMPERR_SUCCESS if it's still valid, or SNMPERR_GENERR if not. 
<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01480">1480</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01481 {
01482     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *asp, *prev_asp = NULL;
01483 
01484     <font class="keywordflow">for</font>(asp = <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a>; asp; prev_asp = asp, asp = asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>) {
01485         <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;transid == transaction_id)
01486             <font class="keywordflow">return</font> SNMPERR_SUCCESS;
01487     }
01488     <font class="keywordflow">return</font> SNMPERR_GENERR;
01489 }
</pre></div>    </td>
  </tr>
</table>
<a name="a41" doxytag="snmp_agent.c::create_subtree_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int create_subtree_cache </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01242">1242</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>().
<p>
<div class="fragment"><pre>01242                                                       {
01243     <font class="keyword">struct </font><a class="code" href="structsubtree.html">subtree</a> *tp;
01244     <font class="keyword">struct </font>variable_list *varbind_ptr;
01245     <font class="keywordtype">int</font> ret;
01246     <font class="keywordtype">int</font> view;
01247     <font class="keywordtype">int</font> vbcount = 0;
01248 
01249     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> == NULL &amp;&amp;
01250         asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a> == 0) {
01251         asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a> = 16;
01252         asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> = malloc(<font class="keyword">sizeof</font>(<a class="code" href="structtree__cache__s.html">tree_cache</a> *) * asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>);
01253         <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> == NULL)
01254             <font class="keywordflow">return</font> SNMP_ERR_GENERR;
01255     }
01256     asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a> = -1;
01257 
01258     <font class="comment">/* collect varbinds into their registered trees */</font>
01259 
01260     <font class="keywordflow">for</font>(varbind_ptr = asp-&gt;<a class="code" href="structagent__snmp__session.html#m1">start</a>; varbind_ptr;
01261         varbind_ptr = varbind_ptr-&gt;next_variable) {
01262 
01263         <font class="comment">/* count the varbinds */</font>
01264         ++vbcount;
01265         
01266         <font class="keywordflow">if</font> (varbind_ptr-&gt;type != ASN_NULL &amp;&amp;  <font class="comment">/* skip previously answered */</font>
01267             !(<a class="code" href="snmp__agent_8h.html#a15">MODE_IS_SET</a>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command)))
01268             <font class="keywordflow">continue</font>;
01269 
01270         <font class="comment">/* find the owning tree */</font>
01271         tp = <a class="code" href="agent__registry_8h.html#a33">find_subtree</a>(varbind_ptr-&gt;name, varbind_ptr-&gt;name_length, NULL,
01272                           asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;contextName); <font class="comment">/* WWW: only v3 pdu's have */</font>
01273 
01274         <font class="comment">/* check access control */</font>
01275         <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command) {
01276             <font class="keywordflow">case</font> SNMP_MSG_GET:
01277                 view = <a class="code" href="agent__registry_8h.html#a49">in_a_view</a>(varbind_ptr-&gt;name, &amp;varbind_ptr-&gt;name_length,
01278                                  asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>, varbind_ptr-&gt;type);
01279                 <font class="keywordflow">if</font> (view != VACM_SUCCESS)
01280                     snmp_set_var_typed_value(varbind_ptr, SNMP_NOSUCHOBJECT,
01281                                              NULL, 0);
01282                 <font class="keywordflow">break</font>;
01283 
01284             <font class="keywordflow">case</font> SNMP_MSG_SET:
01285                 view = <a class="code" href="agent__registry_8h.html#a49">in_a_view</a>(varbind_ptr-&gt;name, &amp;varbind_ptr-&gt;name_length,
01286                                  asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>, varbind_ptr-&gt;type);
01287                 <font class="keywordflow">if</font> (view != VACM_SUCCESS)
01288                     <font class="keywordflow">return</font> SNMP_ERR_NOTWRITABLE;
01289                 <font class="keywordflow">break</font>;
01290 
01291             <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
01292             <font class="keywordflow">default</font>:
01293                 view = VACM_SUCCESS;
01294                 <font class="comment">/* WWW: check VACM here to see if "tp" is even worthwhile */</font>
01295         }
01296         <font class="keywordflow">if</font> (view == VACM_SUCCESS) {
01297             ret = <a class="code" href="snmp__agent_8c.html#a39">add_varbind_to_cache</a>(asp, vbcount, varbind_ptr, tp);
01298             <font class="keywordflow">if</font> (ret != SNMP_ERR_NOERROR)
01299                 <font class="keywordflow">return</font> ret;
01300         }
01301     }
01302 
01303     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
01304 }
</pre></div>    </td>
  </tr>
</table>
<a name="a43" doxytag="snmp_agent.c::delete_request_infos"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void delete_request_infos </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>reqlist</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01357">1357</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01370">delete_subtree_cache</a>().
<p>
<div class="fragment"><pre>01357                                             {
01358     <a class="code" href="structrequest__info__s.html">request_info</a> *saveit;
01359     <font class="keywordflow">while</font>(reqlist) {
01360         <font class="comment">/* don't delete varbind */</font>
01361         saveit = reqlist;
01362         reqlist = reqlist-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>;
01363         <font class="keywordflow">if</font> (saveit-&gt;<a class="code" href="structrequest__info__s.html#m1">parent_data</a>)
01364             free_all_list_data(saveit-&gt;<a class="code" href="structrequest__info__s.html#m1">parent_data</a>);
01365         free(saveit);
01366     }
01367 }
</pre></div>    </td>
  </tr>
</table>
<a name="a16" doxytag="snmp_agent.c::delete_subtree_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void delete_subtree_cache </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01370">1370</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l00840">free_agent_snmp_session</a>().
<p>
<div class="fragment"><pre>01370                                                       {
01371     <font class="keywordflow">while</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a> &gt;= 0) {
01372         <font class="comment">/* don't delete subtrees */</font>
01373         <a class="code" href="snmp__agent_8c.html#a43">delete_request_infos</a>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>]
01374                              -&gt;requests_begin);
01375         free(asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>]);
01376         asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>--;
01377     }
01378 }
</pre></div>    </td>
  </tr>
</table>
<a name="a30" doxytag="snmp_agent.c::deregister_agent_nsap"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void deregister_agent_nsap </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname1">&nbsp; <em>handle</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00580">580</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00581 {
00582   <a class="code" href="struct__agent__nsap.html">agent_nsap</a> *a = NULL, **prevNext = &amp;agent_nsap_list;
00583   <font class="keywordtype">int</font> main_session_deregistered = 0;
00584 
00585   DEBUGMSGTL((<font class="stringliteral">"deregister_agent_nsap"</font>, <font class="stringliteral">"handle %d\n"</font>, handle));
00586 
00587   <font class="keywordflow">for</font> (a = agent_nsap_list; a != NULL &amp;&amp; a-&gt;<a class="code" href="struct__agent__nsap.html#m0">handle</a> &lt; handle; a = a-&gt;<a class="code" href="struct__agent__nsap.html#m3">next</a>) {
00588     prevNext = &amp;(a-&gt;<a class="code" href="struct__agent__nsap.html#m3">next</a>);
00589   }
00590 
00591   <font class="keywordflow">if</font> (a != NULL &amp;&amp; a-&gt;<a class="code" href="struct__agent__nsap.html#m0">handle</a> == handle) {
00592     *prevNext = a-&gt;<a class="code" href="struct__agent__nsap.html#m3">next</a>;
00593     <font class="keywordflow">if</font> (main_session == snmp_sess_session(a-&gt;<a class="code" href="struct__agent__nsap.html#m2">s</a>))<font class="keyword"> </font>{
00594       main_session_deregistered = 1;
00595     }
00596     snmp_close(snmp_sess_session(a-&gt;<a class="code" href="struct__agent__nsap.html#m2">s</a>));
00597     <font class="comment">/*  The above free()s the transport and session pointers.  */</font>
00598     free(a);
00599   }
00600 
00601   <font class="comment">/*  If we've deregistered the session that main_session used to point to,</font>
00602       then make it point to another one, or in the last resort, make it equal
00603       to NULL.  Basically this shouldn't ever happen in normal operation
00604       because main_session starts off pointing at the first session added by
00605       init_master_agent(), which then discards the handle.  */
00606 
00607   <font class="keywordflow">if</font> (main_session_deregistered) {
00608     <font class="keywordflow">if</font> (agent_nsap_list != NULL) {
00609       DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>,
00610                   <font class="stringliteral">"WARNING: main_session pointer changed from %p to %p\n"</font>,
00611                   main_session, snmp_sess_session(agent_nsap_list-&gt;s)));
00612       main_session = snmp_sess_session(agent_nsap_list-&gt;s);
00613     } <font class="keywordflow">else</font> {
00614       DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>,
00615                   <font class="stringliteral">"WARNING: main_session pointer changed from %p to NULL\n"</font>,
00616                   main_session));
00617       main_session = NULL;
00618     }
00619   }
00620 }
</pre></div>    </td>
  </tr>
</table>
<a name="a35" doxytag="snmp_agent.c::dump_sess_list"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void dump_sess_list </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00972">972</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00973 {
00974     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *a;
00975     
00976     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"DUMP agent_sess_list -&gt; "</font>));
00977     <font class="keywordflow">for</font> (a = agent_session_list; a != NULL; a = a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>) {
00978         DEBUGMSG((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"%08p[session %08p] -&gt; "</font>, a, a-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a>));
00979     }
00980     DEBUGMSG((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"[NIL]\n"</font>));
00981 }
</pre></div>    </td>
  </tr>
</table>
<a name="a59" doxytag="snmp_agent.c::free_agent_data_set"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void free_agent_data_set </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>agent</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01958">1958</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01959 {
01960   <font class="keywordflow">if</font> (ari)
01961     free_list_data(ari-&gt;agent_data);
01962 }
</pre></div>    </td>
  </tr>
</table>
<a name="a60" doxytag="snmp_agent.c::free_agent_data_sets"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void free_agent_data_sets </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>agent</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01965">1965</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01966 {
01967   <font class="keywordflow">if</font> (ari)
01968     free_all_list_data(ari-&gt;agent_data);
01969 }
</pre></div>    </td>
  </tr>
</table>
<a name="a61" doxytag="snmp_agent.c::free_agent_request_info"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void free_agent_request_info </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>ari</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01972">1972</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01973 {
01974     <font class="keywordflow">if</font> (ari) {
01975         <font class="keywordflow">if</font> (ari-&gt;<a class="code" href="structagent__request__info__s.html#m3">agent_data</a>)
01976             free_all_list_data(ari-&gt;<a class="code" href="structagent__request__info__s.html#m3">agent_data</a>);
01977         free(ari);
01978     }
01979 }
</pre></div>    </td>
  </tr>
</table>
<a name="a33" doxytag="snmp_agent.c::free_agent_snmp_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void free_agent_snmp_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00840">840</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00841 {
00842     <font class="keywordflow">if</font> (!asp)
00843         <font class="keywordflow">return</font>;
00844     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m5">orig_pdu</a>)
00845         snmp_free_pdu(asp-&gt;<a class="code" href="structagent__snmp__session.html#m5">orig_pdu</a>);
00846     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>)
00847         snmp_free_pdu(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>);
00848     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>)
00849         <a class="code" href="snmp__agent_8h.html#a53">free_agent_request_info</a>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>);
00850     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>) {
00851         <a class="code" href="snmp__agent_8c.html#a16">delete_subtree_cache</a>(asp);
00852         free(asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>);
00853     }
00854     free(asp);
00855 }
</pre></div>    </td>
  </tr>
</table>
<a name="a37" doxytag="snmp_agent.c::free_agent_snmp_session_by_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void free_agent_snmp_session_by_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>sess</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void(*&nbsp;</td>
          <td class="mdname">&nbsp; <em>free_request</em>)(struct request_list *)</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01009">1009</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01011 {
01012     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *a, *next, **prevNext = &amp;agent_session_list;
01013 
01014     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"REMOVE session == %08p\n"</font>, sess));
01015 
01016     <font class="keywordflow">for</font> (a = agent_session_list; a != NULL; a = next) {
01017         <font class="keywordflow">if</font> (a-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a> == sess) {
01018             *prevNext = a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
01019             next = a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
01020             <a class="code" href="snmp__agent_8h.html#a30">free_agent_snmp_session</a>(a);
01021         } <font class="keywordflow">else</font> {
01022             prevNext = &amp;(a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>);
01023             next = a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
01024         }
01025     }
01026 }
</pre></div>    </td>
  </tr>
</table>
<a name="a24" doxytag="snmp_agent.c::getNextSessID"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int getNextSessID </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00248">248</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00249 {
00250     <font class="keyword">static</font> <font class="keywordtype">int</font> SessionID = 0;
00251 
00252     <font class="keywordflow">return</font> ++SessionID;
00253 }
</pre></div>    </td>
  </tr>
</table>
<a name="a56" doxytag="snmp_agent.c::get_agent_uptime"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int get_agent_uptime </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01928">1928</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01928                          {
01929 
01930         <font class="keyword">struct </font>timeval now;
01931         gettimeofday(&amp;now, NULL);
01932 
01933         <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8h.html#a42">timeval_uptime</a>( &amp;now );
01934 }
</pre></div>    </td>
  </tr>
</table>
<a name="a23" doxytag="snmp_agent.c::get_set_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void get_set_cache </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00219">219</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>().
<p>
<div class="fragment"><pre>00220 {
00221     <a class="code" href="structagent__set__cache__s.html">agent_set_cache</a> *ptr, *prev=NULL;
00222 
00223     <font class="keywordflow">for</font> ( ptr=Sets ; ptr != NULL ; ptr=ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m7">next</a> ) {
00224         <font class="keywordflow">if</font> ( ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m1">sess</a> == asp-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a> &amp;&amp; ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m0">transID</a> == asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;transid ) {
00225             <font class="keywordflow">if</font> ( prev )
00226                 prev-&gt;<a class="code" href="structagent__set__cache__s.html#m7">next</a> = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m7">next</a>;
00227             <font class="keywordflow">else</font>
00228                 Sets = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m7">next</a>;
00229 
00230             <font class="comment">/* found it.  Get the needed data */</font>
00231             asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>           = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m2">treecache</a>;
00232             asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>       = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m3">treecache_len</a>;
00233             asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>       = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m4">treecache_num</a>;
00234             <font class="keywordflow">if</font> (!asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>) {
00235                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a> = SNMP_MALLOC_TYPEDEF(<a class="code" href="structagent__request__info__s.html">agent_request_info</a>);
00236                 <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>) {
00237                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;asp = asp;
00238                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;agent_data = ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m6">agent_data</a>;
00239                 }
00240             }
00241             free(ptr);
00242             <font class="keywordflow">return</font>;
00243         }
00244         prev = ptr;
00245     }
00246 }
</pre></div>    </td>
  </tr>
</table>
<a name="a20" doxytag="snmp_agent.c::handle_getnext_loop"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_getnext_loop </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
repeatedly calls getnext handlers looking for an answer till all requests are satisified.
<p>
It's expected that one pass has been made before entering this function 
<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01597">1597</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01501">check_delayed_request</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>().
<p>
<div class="fragment"><pre>01597                                                      {
01598     <font class="keywordtype">int</font> status;
01599     <font class="keyword">struct </font>variable_list *var_ptr;
01600     <font class="keywordtype">int</font> count;
01601 
01602     <font class="comment">/* loop */</font>
01603     <font class="keywordflow">while</font> (1) {
01604 
01605         <font class="comment">/* bail for now if anything is delegated. */</font>
01606         <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))<font class="keyword"> </font>{
01607                 <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01608         }
01609 
01610         <font class="comment">/* check vacm against results */</font>
01611         <a class="code" href="snmp__agent_8c.html#a40">check_acm</a>(asp, ASN_PRIV_RETRY);
01612 
01613         <font class="comment">/* need to keep going we're not done yet. */</font>
01614         <font class="keywordflow">if</font> (!<a class="code" href="snmp__agent_8c.html#a49">check_getnext_results</a>(asp))
01615             <font class="comment">/* nothing left, quit now */</font>
01616             <font class="keywordflow">break</font>;
01617             
01618         <font class="comment">/* never had a request (empty pdu), quit now */</font>
01619         <font class="comment">/* XXXWWW: huh?  this would be too late, no?  shouldn't we</font>
01620            catch this earlier? */
01621 <font class="comment">/*        if (count == 0)</font>
01622           break; */
01623         
01624         DEBUGIF(<font class="stringliteral">"results"</font>)<font class="keyword"> </font>{
01625             DEBUGMSGTL((<font class="stringliteral">"results"</font>,<font class="stringliteral">"getnext results, before next pass: \n"</font>));
01626             <font class="keywordflow">for</font>(var_ptr = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables; var_ptr;
01627                 var_ptr = var_ptr-&gt;next_variable) {
01628                 <font class="keywordtype">char</font> buf[SPRINT_MAX_LEN];
01629                 sprint_variable(buf, var_ptr-&gt;name, var_ptr-&gt;name_length, var_ptr);
01630                 DEBUGMSGTL((<font class="stringliteral">"results"</font>,<font class="stringliteral">"  %s\n"</font>, buf));
01631             }
01632         }
01633 
01634         <a class="code" href="snmp__agent_8c.html#a42">reassign_requests</a>(asp);
01635         status = <a class="code" href="snmp__agent_8c.html#a46">handle_var_requests</a>(asp);
01636         <font class="keywordflow">if</font> (status != SNMP_ERR_NOERROR) {
01637             <font class="keywordflow">return</font> status; <font class="comment">/* should never really happen */</font>
01638         }
01639     }
01640     <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01641 }
</pre></div>    </td>
  </tr>
</table>
<a name="a17" doxytag="snmp_agent.c::handle_pdu"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_pdu </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01738">1738</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01030">handle_snmp_packet</a>().
<p>
<div class="fragment"><pre>01738                                             {
01739     <font class="keywordtype">int</font> status;
01740 
01741     <font class="comment">/* for illegal requests, mark all nodes as ASN_NULL */</font>
01742     <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command) {
01743 
01744         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE2:
01745         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_ACTION:
01746         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_COMMIT:
01747         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_FREE:
01748         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_UNDO:
01749             <a class="code" href="snmp__agent_8c.html#a23">get_set_cache</a>(asp);
01750             <font class="keywordflow">break</font>;
01751 
01752         <font class="keywordflow">case</font> SNMP_MSG_GET:
01753         <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
01754         <font class="keywordflow">case</font> SNMP_MSG_GETBULK:
01755             snmp_reset_var_types(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables, ASN_NULL);
01756             <font class="comment">/* fall through */</font>
01757 
01758         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_BEGIN:
01759         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE1:
01760         <font class="keywordflow">default</font>:
01761             <font class="comment">/* collect varbinds */</font>
01762             status = <a class="code" href="snmp__agent_8c.html#a41">create_subtree_cache</a>(asp);
01763             <font class="keywordflow">if</font> (status != SNMP_ERR_NOERROR)
01764                 <font class="keywordflow">return</font> status;
01765     }
01766     
01767     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command;
01768     <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>) {
01769         <font class="keywordflow">case</font> SNMP_MSG_GET:
01770             <font class="comment">/* increment the message type counter */</font>
01771             snmp_increment_statistic(STAT_SNMPINGETREQUESTS);
01772 
01773             <font class="comment">/* check vacm ahead of time */</font>
01774             <a class="code" href="snmp__agent_8c.html#a40">check_acm</a>(asp, SNMP_NOSUCHOBJECT);
01775                 
01776             <font class="comment">/* get the results */</font>
01777             status = <a class="code" href="snmp__agent_8c.html#a46">handle_var_requests</a>(asp);
01778 
01779             <font class="comment">/* deal with unhandled results -&gt; noSuchObject */</font>
01780             <font class="keywordflow">if</font> (status == SNMP_ERR_NOERROR)
01781                 snmp_replace_var_types(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables, ASN_NULL,
01782                                        SNMP_NOSUCHOBJECT);
01783             <font class="keywordflow">break</font>;
01784 
01785         <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
01786             <font class="comment">/* increment the message type counter */</font>
01787             snmp_increment_statistic(STAT_SNMPINGETNEXTS);
01788 
01789             <font class="comment">/* loop through our mib tree till we find an</font>
01790                appropriate response to return to the caller. */
01791 
01792             <font class="comment">/* first pass */</font>
01793             status = <a class="code" href="snmp__agent_8c.html#a46">handle_var_requests</a>(asp);
01794             <font class="keywordflow">if</font> (status != SNMP_ERR_NOERROR) {
01795                 <font class="keywordflow">return</font> status; <font class="comment">/* should never really happen */</font>
01796             }
01797 
01798             <a class="code" href="snmp__agent_8c.html#a20">handle_getnext_loop</a>(asp);
01799             <font class="keywordflow">break</font>;
01800 
01801         <font class="keywordflow">case</font> SNMP_MSG_SET:
01802             <font class="comment">/* check access permissions first */</font>
01803             <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8c.html#a40">check_acm</a>(asp, SNMP_NOSUCHOBJECT))
01804                 <font class="keywordflow">return</font> SNMP_ERR_NOTWRITABLE;
01805 
01806             asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a8">MODE_SET_BEGIN</a>;
01807             status = <a class="code" href="snmp__agent_8c.html#a21">handle_set_loop</a>(asp);
01808             
01809             <font class="keywordflow">break</font>;
01810 
01811         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_BEGIN:
01812         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE1:
01813         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE2:
01814         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_ACTION:
01815         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_COMMIT:
01816         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_FREE:
01817         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_UNDO:
01818             asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;flags |= UCD_MSG_FLAG_ONE_PASS_ONLY;
01819             status = <a class="code" href="snmp__agent_8c.html#a21">handle_set_loop</a>(asp);
01820             <font class="comment">/* asp related cache is saved in cleanup */</font>
01821             <font class="keywordflow">break</font>;
01822 
01823         <font class="keywordflow">case</font> SNMP_MSG_GETBULK:
01824             <font class="keywordflow">break</font>;
01825             <font class="comment">/* WWW */</font>
01826 
01827         <font class="keywordflow">case</font> SNMP_MSG_RESPONSE:
01828             snmp_increment_statistic(STAT_SNMPINGETRESPONSES);
01829             <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01830             
01831         <font class="keywordflow">case</font> SNMP_MSG_TRAP:
01832         <font class="keywordflow">case</font> SNMP_MSG_TRAP2:
01833             snmp_increment_statistic(STAT_SNMPINTRAPS);
01834             <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01835             
01836         <font class="keywordflow">default</font>:
01837             <font class="comment">/* WWW: are reports counted somewhere ? */</font>
01838             snmp_increment_statistic(STAT_SNMPINASNPARSEERRS);
01839             <font class="keywordflow">return</font> SNMPERR_GENERR; <font class="comment">/* shouldn't get here */</font>
01840             <font class="comment">/* WWW */</font>
01841     }
01842     <font class="keywordflow">return</font> status;
01843 }
</pre></div>    </td>
  </tr>
</table>
<a name="a50" doxytag="snmp_agent.c::handle_set"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_set </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01644">1644</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01726">handle_set_loop</a>().
<p>
<div class="fragment"><pre>01644                                             {
01645     <font class="keywordtype">int</font> status;
01646     <font class="comment">/*</font>
01647      * SETS require 3-4 passes through the var_op_list.
01648      * The first two
01649      * passes verify that all types, lengths, and values are valid
01650      * and may reserve resources and the third does the set and a
01651      * fourth executes any actions.  Then the identical GET RESPONSE
01652      * packet is returned.
01653      * If either of the first two passes returns an error, another
01654      * pass is made so that any reserved resources can be freed.
01655      * If the third pass returns an error, another pass is
01656      * made so that
01657      * any changes can be reversed.
01658      * If the fourth pass (or any of the error handling passes)
01659      * return an error, we'd rather not know about it!
01660      */
01661     <font class="keywordflow">if</font> (!(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;flags &amp; UCD_MSG_FLAG_ONE_PASS_ONLY)) {
01662         <font class="keywordflow">switch</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>) {
01663             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a8">MODE_SET_BEGIN</a>:
01664                 snmp_increment_statistic(STAT_SNMPINSETREQUESTS);
01665                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m6">rw</a>      = WRITE; <font class="comment">/* WWW: still needed? */</font>
01666                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>;
01667                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = SNMP_ERR_NOERROR;
01668                 <font class="keywordflow">break</font>;
01669             
01670             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>:
01671 
01672                 <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> != SNMP_ERR_NOERROR )
01673                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a13">MODE_SET_FREE</a>;
01674                 <font class="keywordflow">else</font>
01675                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a10">MODE_SET_RESERVE2</a>;
01676                 <font class="keywordflow">break</font>;
01677 
01678             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a10">MODE_SET_RESERVE2</a>:
01679                 <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> != SNMP_ERR_NOERROR )
01680                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a13">MODE_SET_FREE</a>;
01681                 <font class="keywordflow">else</font>
01682                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a11">MODE_SET_ACTION</a>;
01683                 <font class="keywordflow">break</font>;
01684 
01685             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a11">MODE_SET_ACTION</a>:
01686                 <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> != SNMP_ERR_NOERROR )
01687                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a14">MODE_SET_UNDO</a>;
01688                 <font class="keywordflow">else</font>
01689                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = <a class="code" href="snmp__agent_8h.html#a12">MODE_SET_COMMIT</a>;
01690                 <font class="keywordflow">break</font>;
01691 
01692             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a12">MODE_SET_COMMIT</a>:
01693                 <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> != SNMP_ERR_NOERROR ) {
01694                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>    = SNMP_ERR_COMMITFAILED;
01695                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = FINISHED_FAILURE;
01696                 }
01697                 <font class="keywordflow">else</font>
01698                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = FINISHED_SUCCESS;
01699                 <font class="keywordflow">break</font>;
01700 
01701             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a14">MODE_SET_UNDO</a>:
01702                 <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> != SNMP_ERR_NOERROR )
01703                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = SNMP_ERR_UNDOFAILED;
01704 
01705                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = FINISHED_FAILURE;
01706                 <font class="keywordflow">break</font>;
01707 
01708             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a13">MODE_SET_FREE</a>:
01709                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> = FINISHED_FAILURE;
01710                 <font class="keywordflow">break</font>;
01711         }
01712     }
01713     
01714     <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_SUCCESS &amp;&amp; asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_FAILURE) {
01715         DEBUGMSGTL((<font class="stringliteral">"agent_set"</font>,<font class="stringliteral">"doing set mode = %d\n"</font>,asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>));
01716         status = <a class="code" href="snmp__agent_8c.html#a46">handle_var_requests</a>( asp );
01717         <font class="keywordflow">if</font> (status != SNMP_ERR_NOERROR &amp;&amp; asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> == SNMP_ERR_NOERROR)
01718             asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = status;
01719         DEBUGMSGTL((<font class="stringliteral">"agent_set"</font>,<font class="stringliteral">"did set mode = %d, status = %d\n"</font>,
01720                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>, asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>));
01721     }
01722     <font class="keywordflow">return</font> asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
01723 }
</pre></div>    </td>
  </tr>
</table>
<a name="a21" doxytag="snmp_agent.c::handle_set_loop"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_set_loop </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01726">1726</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01501">check_delayed_request</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>().
<p>
<div class="fragment"><pre>01726                                                  {
01727     <font class="keywordflow">while</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_FAILURE &amp;&amp; asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a> != FINISHED_SUCCESS) {
01728         <a class="code" href="snmp__agent_8c.html#a50">handle_set</a>(asp);
01729         <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))
01730             <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01731         <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;flags &amp; UCD_MSG_FLAG_ONE_PASS_ONLY)
01732             <font class="keywordflow">return</font> asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
01733     }
01734     <font class="keywordflow">return</font> asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
01735 }
</pre></div>    </td>
  </tr>
</table>
<a name="a38" doxytag="snmp_agent.c::handle_snmp_packet"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_snmp_packet </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>op</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>session</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqid</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_pdu *&nbsp;</td>
          <td class="mdname">&nbsp; <em>pdu</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname">&nbsp; <em>magic</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
handles an incoming SNMP packet into the agent.
<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01030">1030</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01032 {
01033     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a>  *asp;
01034     <font class="keywordtype">int</font> status, access_ret;
01035     <font class="keyword">struct </font>variable_list *var_ptr;
01036 
01037     <font class="comment">/* we only support receiving here */</font>
01038     <font class="keywordflow">if</font> (op != SNMP_CALLBACK_OP_RECEIVED_MESSAGE) {
01039       <font class="keywordflow">return</font> 1;
01040     }
01041 
01042     <font class="comment">/* new request */</font>
01043     asp = <a class="code" href="snmp__agent_8h.html#a29">init_agent_snmp_session</a>( session, pdu );
01044     status = SNMP_ERR_NOERROR;
01045 
01046     <font class="comment">/* initial access check.  Is request user/community allowed to do</font>
01047        anything at all? If not, abondon all hope here. */
01048     <font class="keywordflow">if</font> ((access_ret = <a class="code" href="agent__registry_8h.html#a50">check_access</a>(pdu)) != 0) {
01049         <font class="keywordflow">if</font> (access_ret == VACM_NOSUCHCONTEXT) {
01050             <font class="comment">/* rfc2573 section 3.2, step 5 says that we increment the</font>
01051                counter but don't return a response of any kind */
01052                
01053             <font class="comment">/* we currently don't support unavailable contexts, as</font>
01054                there is no reason to that I currently know of */
01055             snmp_increment_statistic(STAT_SNMPUNKNOWNCONTEXTS);
01056 
01057             <font class="comment">/* drop the request */</font>
01058             <a class="code" href="snmp__agent_8h.html#a31">remove_and_free_agent_snmp_session</a>( asp );
01059             <font class="keywordflow">return</font> 0;
01060         } <font class="keywordflow">else</font> {
01061             <font class="comment">/* access control setup is incorrect */</font>
01062             <a class="code" href="agent__trap_8h.html#a0">send_easy_trap</a>(SNMP_TRAP_AUTHFAIL, 0);
01063             <font class="keywordflow">if</font> (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;version != SNMP_VERSION_1 &amp;&amp;
01064                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;version != SNMP_VERSION_2c) {
01065                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;errstat = SNMP_ERR_AUTHORIZATIONERROR;
01066                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command = SNMP_MSG_RESPONSE;
01067                 snmp_increment_statistic(STAT_SNMPOUTPKTS);
01068                 <font class="keywordflow">if</font> (! snmp_send( asp-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a>, asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> ))
01069                     snmp_free_pdu(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>);
01070                 asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> = NULL;
01071                 <a class="code" href="snmp__agent_8h.html#a31">remove_and_free_agent_snmp_session</a>(asp);
01072                 <font class="keywordflow">return</font> 1;
01073             } <font class="keywordflow">else</font> {
01074                 <font class="comment">/* drop the request */</font>
01075                 <a class="code" href="snmp__agent_8h.html#a31">remove_and_free_agent_snmp_session</a>( asp );
01076                 <font class="keywordflow">return</font> 0;
01077             }
01078         }
01079     }
01080 
01081     <font class="comment">/* process the request */</font>
01082     status = <a class="code" href="snmp__agent_8c.html#a17">handle_pdu</a>(asp);
01083 
01084     <font class="comment">/* print the results in approrpiate debugging mode */</font>
01085     DEBUGIF(<font class="stringliteral">"results"</font>)<font class="keyword"> </font>{
01086         DEBUGMSGTL((<font class="stringliteral">"results"</font>,<font class="stringliteral">"request results (status = %d): \n"</font>, status));
01087         <font class="keywordflow">for</font>(var_ptr = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables; var_ptr;
01088             var_ptr = var_ptr-&gt;next_variable) {
01089             <font class="keywordtype">char</font> buf[SPRINT_MAX_LEN];
01090             sprint_variable(buf, var_ptr-&gt;name, var_ptr-&gt;name_length, var_ptr);
01091             DEBUGMSGTL((<font class="stringliteral">"results"</font>,<font class="stringliteral">"  %s\n"</font>, buf));
01092         }
01093     }
01094 
01095     <font class="comment">/* check for uncompleted requests */</font>
01096     <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8c.html#a34">check_for_delegated</a>(asp))<font class="keyword"> </font>{
01097         <font class="comment">/* add to delegated request chain */</font>
01098         asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a> = status;
01099         asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a> = <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a>;
01100         <a class="code" href="snmp__agent_8c.html#a8">agent_delegated_list</a> = asp;
01101     } <font class="keywordflow">else</font> {
01102         <font class="comment">/* if we don't have anything outstanding (delegated), wrap up */</font>
01103         <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8c.html#a18">wrap_up_request</a>(asp, status);
01104     }
01105 
01106     <font class="comment">/* done */</font>
01107     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"end of handle_snmp_packet, asp = %08p\n"</font>, asp));
01108     <font class="keywordflow">return</font> 1;
01109 }
</pre></div>    </td>
  </tr>
</table>
<a name="a46" doxytag="snmp_agent.c::handle_var_requests"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int handle_var_requests </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01405">1405</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01597">handle_getnext_loop</a>(), <a class="el" href="snmp__agent_8c-source.html#l01738">handle_pdu</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01644">handle_set</a>().
<p>
<div class="fragment"><pre>01405                                                      {
01406     <font class="keywordtype">int</font> i, retstatus = SNMP_ERR_NOERROR,
01407         status = SNMP_ERR_NOERROR, final_status = SNMP_ERR_NOERROR;
01408     <a class="code" href="structhandler__registration__s.html">handler_registration</a> *reginfo;
01409 
01410     <font class="comment">/* create the agent_request_info data */</font>
01411     <font class="keywordflow">if</font> (!asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>) {
01412         asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a> = SNMP_MALLOC_TYPEDEF(<a class="code" href="structagent__request__info__s.html">agent_request_info</a>);
01413         <font class="keywordflow">if</font> (!asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>)
01414             <font class="keywordflow">return</font> SNMP_ERR_GENERR;
01415     }
01416 
01417     asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;asp = asp;
01418     asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;mode = asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>;
01419 
01420     <font class="comment">/* now, have the subtrees in the cache go search for their results */</font>
01421     <font class="keywordflow">for</font>(i=0; i &lt;= asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>; i++) {
01422         reginfo = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;subtree-&gt;reginfo;
01423         status = <a class="code" href="helpers_2agent__handler_8h.html#a16">call_handlers</a>(reginfo, asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>,
01424                                asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;requests_begin);
01425 
01426         <font class="comment">/* find any errors marked in the requests */</font>
01427         retstatus =
01428             <a class="code" href="snmp__agent_8c.html#a44">check_requests_status</a>(asp, asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>[i]-&gt;requests_begin);
01429 
01430         <font class="comment">/* always take lowest varbind if possible */</font>
01431         <font class="keywordflow">if</font> (retstatus != SNMP_ERR_NOERROR)
01432             status = retstatus;
01433         
01434         <font class="comment">/* other things we know less about (no index) */</font>
01435         <font class="comment">/* WWW: drop support for this? */</font>
01436         <font class="keywordflow">if</font> (final_status == SNMP_ERR_NOERROR &amp;&amp;
01437             status != SNMP_ERR_NOERROR) {
01438             <font class="comment">/* we can't break here, since some processing needs to be</font>
01439                done for all requests anyway (IE, SET handling for UNDO
01440                needs to be called regardless of previous status
01441                results.
01442                WWW:  This should be predictable though and
01443                breaking should be possible in some cases (eg GET,
01444                GETNEXT, ...) */
01445             final_status = status;
01446         }
01447     }
01448 
01449    <font class="keywordflow">return</font> final_status;
01450 }
</pre></div>    </td>
  </tr>
</table>
<a name="a32" doxytag="snmp_agent.c::init_agent_snmp_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a>* init_agent_snmp_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>session</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_pdu *&nbsp;</td>
          <td class="mdname">&nbsp; <em>pdu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00812">812</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00813 {
00814     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a>  *asp;
00815 
00816     asp = (<font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *) calloc(1, sizeof( struct agent_snmp_session ));
00817 
00818     <font class="keywordflow">if</font> ( asp == NULL )
00819         <font class="keywordflow">return</font> NULL;
00820     asp-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a> = session;
00821     asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>      = snmp_clone_pdu(pdu);
00822     asp-&gt;<a class="code" href="structagent__snmp__session.html#m5">orig_pdu</a> = snmp_clone_pdu(pdu);
00823     asp-&gt;<a class="code" href="structagent__snmp__session.html#m6">rw</a>      = READ;
00824     asp-&gt;<a class="code" href="structagent__snmp__session.html#m7">exact</a>   = TRUE;
00825     asp-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>    = NULL;
00826     asp-&gt;<a class="code" href="structagent__snmp__session.html#m0">mode</a>    = RESERVE1;
00827     asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>  = SNMP_ERR_NOERROR;
00828     asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a>   = 0;
00829 
00830     asp-&gt;<a class="code" href="structagent__snmp__session.html#m1">start</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables;
00831     asp-&gt;<a class="code" href="structagent__snmp__session.html#m2">end</a>   = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables;
00832     <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m2">end</a> != NULL )
00833         <font class="keywordflow">while</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m2">end</a>-&gt;next_variable != NULL )
00834             asp-&gt;<a class="code" href="structagent__snmp__session.html#m2">end</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m2">end</a>-&gt;next_variable;
00835 
00836     <font class="keywordflow">return</font> asp;
00837 }
</pre></div>    </td>
  </tr>
</table>
<a name="a31" doxytag="snmp_agent.c::init_master_agent"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int init_master_agent </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00648">648</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmpd_8c-source.html#l00291">main</a>().
<p>
<div class="fragment"><pre>00649 {
00650   snmp_transport *transport;
00651   <font class="keywordtype">char</font> *cptr, *cptr2;
00652   <font class="keywordtype">char</font> buf[SPRINT_MAX_LEN];
00653 
00654   <font class="keywordflow">if</font> (ds_get_boolean(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a1">DS_AGENT_ROLE</a>) != <a class="code" href="snmpd_8h.html#a0">MASTER_AGENT</a>)<font class="keyword"> </font>{
00655     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"init_master_agent; not master agent\n"</font>));
00656     <font class="keywordflow">return</font> 0; <font class="comment">/*  No error if ! MASTER_AGENT  */</font>
00657   }
00658 
00659 <font class="preprocessor">#ifdef USING_AGENTX_MASTER_MODULE</font>
00660     <font class="keywordflow">if</font> ( ds_get_boolean(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a3">DS_AGENT_AGENTX_MASTER</a>) == 1 )
00661         real_init_master();
00662 <font class="preprocessor">#endif</font>
00663 
00664   <font class="comment">/*  Have specific agent ports been specified?  */</font>
00665   cptr = ds_get_string(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a6">DS_AGENT_PORTS</a>);
00666 
00667   <font class="keywordflow">if</font> (cptr) {
00668     sprintf(buf, <font class="stringliteral">"%s"</font>, cptr);
00669   } <font class="keywordflow">else</font> {
00670     <font class="comment">/*  No, so just specify the default port.  */</font>
00671     <font class="keywordflow">if</font> (ds_get_int(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a8">DS_AGENT_FLAGS</a>) &amp;
00672         SNMP_FLAGS_STREAM_SOCKET)<font class="keyword"> </font>{
00673       sprintf(buf, <font class="stringliteral">"tcp:%d"</font>, SNMP_PORT);
00674     } <font class="keywordflow">else</font> {
00675       sprintf(buf, <font class="stringliteral">"udp:%d"</font>, SNMP_PORT);
00676     }
00677   }
00678 
00679   DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"final port spec: %s\n"</font>, buf));
00680   cptr = strtok(buf, <font class="stringliteral">","</font>);
00681   <font class="keywordflow">while</font> (cptr) {
00682     <font class="comment">/*  Specification format: </font>
00683         
00684         NONE:                     (a pseudo-transport)
00685         UDP:[address:]port        (also default if no transport is specified)
00686         TCP:[address:]port        (if supported)
00687         Unix:pathname             (if supported)
00688         AAL5PVC:itf.vpi.vci       (if supported)
00689         IPX:[network]:node[/port] (if supported)
00690 
00691     */
00692 
00693     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"installing master agent on port %s\n"</font>, cptr));
00694 
00695     <font class="keywordflow">if</font> (!cptr || !(*cptr)) {
00696       snmp_log(LOG_ERR, <font class="stringliteral">"improper port specification\n"</font>);
00697       <font class="keywordflow">return</font> 1;
00698     }
00699 
00700     <font class="comment">/*  Transport type specifier?  */</font>
00701 
00702     <font class="keywordflow">if</font> ((cptr2 = strchr(cptr, <font class="charliteral">':'</font>)) != NULL) {
00703       <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"none"</font>, 4) == 0)<font class="keyword"> </font>{
00704         DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>,
00705                  <font class="stringliteral">"init_master_agent; pseudo-transport \"none\" requested\n"</font>));
00706         <font class="keywordflow">return</font> 0;
00707       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"tcp"</font>, 3) == 0)<font class="keyword"> </font>{
00708 <font class="preprocessor">#ifdef SNMP_TRANSPORT_TCP_DOMAIN</font>
00709         <font class="keyword">struct </font>sockaddr_in addr;
00710         <font class="keywordflow">if</font> (snmp_sockaddr_in(&amp;addr, cptr2+1, 0))<font class="keyword"> </font>{
00711           transport = snmp_tcp_transport(&amp;addr, 1);
00712         } <font class="keywordflow">else</font> {
00713           snmp_log(LOG_ERR,
00714                    <font class="stringliteral">"Badly formatted IP address (should be [a.b.c.d:]p)\n"</font>);
00715           <font class="keywordflow">return</font> 1;
00716         }
00717 <font class="preprocessor">#else</font>
00718         snmp_log(LOG_ERR, <font class="stringliteral">"No support for requested TCP domain\n"</font>);
00719         <font class="keywordflow">return</font> 1;
00720 <font class="preprocessor">#endif</font>
00721       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"ipx"</font>, 3) == 0)<font class="keyword"> </font>{
00722 <font class="preprocessor">#ifdef SNMP_TRANSPORT_IPX_DOMAIN</font>
00723         <font class="keyword">struct </font>sockaddr_ipx addr;
00724         <font class="keywordflow">if</font> (snmp_sockaddr_ipx(&amp;addr, cptr2+1))<font class="keyword"> </font>{
00725           transport = snmp_ipx_transport(&amp;addr, 1);
00726         } <font class="keywordflow">else</font> {
00727           snmp_log(LOG_ERR,
00728                <font class="stringliteral">"Badly formatted IPX address (should be [net]:node[/port])\n"</font>);
00729           <font class="keywordflow">return</font> 1;
00730         }
00731 <font class="preprocessor">#else</font>
00732         snmp_log(LOG_ERR, <font class="stringliteral">"No support for requested IPX domain\n"</font>);
00733 <font class="preprocessor">#endif</font>
00734       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"aal5pvc"</font>, 7) == 0)<font class="keyword"> </font>{
00735 <font class="preprocessor">#ifdef SNMP_TRANSPORT_AAL5PVC_DOMAIN</font>
00736         <font class="keyword">struct </font>sockaddr_atmpvc addr;
00737         <font class="keywordflow">if</font> (sscanf(cptr2+1, <font class="stringliteral">"%d.%d.%d"</font>, &amp;(addr.sap_addr.itf),
00738                    &amp;(addr.sap_addr.vpi), &amp;(addr.sap_addr.vci))==3)<font class="keyword"> </font>{
00739           addr.sap_family = AF_ATMPVC;
00740           transport = snmp_aal5pvc_transport(&amp;addr, 1);
00741         } <font class="keywordflow">else</font> {
00742           snmp_log(LOG_ERR,
00743                  <font class="stringliteral">"Badly formatted AAL5 PVC address (should be itf.vpi.vci)\n"</font>);
00744           <font class="keywordflow">return</font> 1;
00745         }
00746 <font class="preprocessor">#else</font>
00747         snmp_log(LOG_ERR, <font class="stringliteral">"No support for requested AAL5 PVC domain\n"</font>);
00748         <font class="keywordflow">return</font> 1;
00749 <font class="preprocessor">#endif</font>
00750       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"unix"</font>, 4) == 0)<font class="keyword"> </font>{
00751 <font class="preprocessor">#ifdef SNMP_TRANSPORT_UNIX_DOMAIN</font>
00752         <font class="keyword">struct </font>sockaddr_un addr;
00753         addr.sun_family = AF_UNIX;
00754         strncpy(addr.sun_path, cptr2+1, 
00755                 <font class="keyword">sizeof</font>(addr) - (size_t) (((<font class="keyword">struct</font> sockaddr_un *)0)-&gt;sun_path));
00756         transport = snmp_unix_transport(&amp;addr, 1);
00757 <font class="preprocessor">#else</font>
00758         snmp_log(LOG_ERR, <font class="stringliteral">"No support for requested Unix domain\n"</font>);
00759         <font class="keywordflow">return</font> 1;
00760 <font class="preprocessor">#endif</font>
00761       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strncasecmp(cptr, <font class="stringliteral">"udp"</font>, 3) == 0)<font class="keyword"> </font>{
00762         <font class="keyword">struct </font>sockaddr_in addr;
00763         <font class="keywordflow">if</font> (snmp_sockaddr_in(&amp;addr, cptr2+1, 0))<font class="keyword"> </font>{
00764           transport = snmp_udp_transport(&amp;addr, 1);
00765         } <font class="keywordflow">else</font> {
00766           snmp_log(LOG_ERR,
00767                    <font class="stringliteral">"Badly formatted IP address (should be [a.b.c.d:]p)\n"</font>);
00768           <font class="keywordflow">return</font> 1;
00769         }
00770       } <font class="keywordflow">else</font> {
00771         snmp_log(LOG_ERR, <font class="stringliteral">"Unknown transport domain \"%s\"\n"</font>, cptr);
00772         <font class="keywordflow">return</font> 1;
00773       }
00774     } <font class="keywordflow">else</font> {
00775       <font class="comment">/*  No transport type specifier; default to UDP.  */</font>
00776       <font class="keyword">struct </font>sockaddr_in addr;
00777       <font class="keywordflow">if</font> (snmp_sockaddr_in(&amp;addr, cptr, 0))<font class="keyword"> </font>{
00778         transport = snmp_udp_transport(&amp;addr, 1);
00779       } <font class="keywordflow">else</font> {
00780         snmp_log(LOG_ERR,
00781                  <font class="stringliteral">"Badly formatted IP address (should be [a.b.c.d:]p)\n"</font>);
00782         <font class="keywordflow">return</font> 1;
00783       }
00784     }
00785 
00786     <font class="keywordflow">if</font> (transport == NULL) {
00787       snmp_log(LOG_ERR, <font class="stringliteral">"Error opening specified transport \"%s\"\n"</font>, cptr);
00788       <font class="keywordflow">return</font> 1;
00789     }
00790 
00791     <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8h.html#a47">register_agent_nsap</a>(transport) == 0)<font class="keyword"> </font>{
00792       snmp_log(LOG_ERR,
00793              <font class="stringliteral">"Error registering specified transport \"%s\" as an agent NSAP\n"</font>,
00794                cptr);
00795       <font class="keywordflow">return</font> 1;
00796     } <font class="keywordflow">else</font> {
00797       DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>,
00798                   <font class="stringliteral">"init_master_agent; \"%s\" registered as an agent NSAP\n"</font>,
00799                   cptr));
00800     }
00801 
00802     <font class="comment">/*  Next transport please...  */</font>
00803     cptr = strtok(NULL, <font class="stringliteral">","</font>);
00804   }
00805 
00806   <font class="keywordflow">return</font> 0;
00807 }
</pre></div>    </td>
  </tr>
</table>
<a name="a54" doxytag="snmp_agent.c::marker_uptime"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int marker_uptime </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>marker_t&nbsp;</td>
          <td class="mdname1">&nbsp; <em>pm</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01911">1911</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01912 {
01913     <font class="keywordtype">int</font> res;
01914     marker_t start = (marker_t)&amp;starttime;
01915 
01916     res = atime_diff( start, pm );
01917     <font class="keywordflow">return</font> res/10;      <font class="comment">/* atime_diff works in msec, not csec */</font>
01918 }
</pre></div>    </td>
  </tr>
</table>
<a name="a42" doxytag="snmp_agent.c::reassign_requests"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int reassign_requests </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01308">1308</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01597">handle_getnext_loop</a>().
<p>
<div class="fragment"><pre>01308                                                    {
01309     <font class="comment">/* assume all the requests have been filled or rejected by the</font>
01310        subtrees, so reassign the rejected ones to the next subtree in
01311        the chain */
01312 
01313     <font class="keywordtype">int</font> i, ret;
01314     <a class="code" href="structrequest__info__s.html">request_info</a> *request, *lastreq = NULL;
01315 
01316     <font class="comment">/* get old info */</font>
01317     <a class="code" href="structtree__cache__s.html">tree_cache</a> **old_treecache = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>;
01318     <font class="keywordtype">int</font> old_treecache_num = asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>;
01319 
01320     <font class="comment">/* malloc new space */</font>
01321     asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> =
01322         (<a class="code" href="structtree__cache__s.html">tree_cache</a> **) malloc(<font class="keyword">sizeof</font>(<a class="code" href="structtree__cache__s.html">tree_cache</a> *) * asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>);
01323     asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a> = -1;
01324 
01325     <font class="keywordflow">for</font>(i = 0; i &lt;= old_treecache_num; i++) {
01326         <font class="keywordflow">for</font>(request = old_treecache[i]-&gt;<a class="code" href="structtree__cache__s.html#m1">requests_begin</a>; request;
01327             request = request-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>) {
01328 
01329             <font class="keywordflow">if</font> (lastreq)
01330                 free(lastreq);
01331             lastreq = request;
01332             
01333             <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type == ASN_NULL) {
01334                 ret = <a class="code" href="snmp__agent_8c.html#a39">add_varbind_to_cache</a>(asp, request-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a>,
01335                                            request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>,
01336                                            old_treecache[i]-&gt;subtree-&gt;next);
01337                 <font class="keywordflow">if</font> (ret != SNMP_ERR_NOERROR)
01338                     <font class="keywordflow">return</font> ret; <font class="comment">/* WWW: mem leak */</font>
01339             } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type == ASN_PRIV_RETRY) {
01340                 <font class="comment">/* re-add the same subtree */</font>
01341                 request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type = ASN_NULL;
01342                 ret = <a class="code" href="snmp__agent_8c.html#a39">add_varbind_to_cache</a>(asp, request-&gt;<a class="code" href="structrequest__info__s.html#m7">index</a>,
01343                                            request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>,
01344                                            old_treecache[i]-&gt;subtree);
01345                 <font class="keywordflow">if</font> (ret != SNMP_ERR_NOERROR)
01346                     <font class="keywordflow">return</font> ret; <font class="comment">/* WWW: mem leak */</font>
01347             }
01348         }
01349     }
01350     <font class="keywordflow">if</font> (lastreq)
01351         free(lastreq);
01352     free(old_treecache);
01353     <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
01354 }
</pre></div>    </td>
  </tr>
</table>
<a name="a29" doxytag="snmp_agent.c::register_agent_nsap"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int register_agent_nsap </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>snmp_transport *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>t</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00508">508</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00509 {
00510   <font class="keyword">struct </font>snmp_session *s, *sp = NULL;
00511   <a class="code" href="struct__agent__nsap.html">agent_nsap</a> *a = NULL, *n = NULL, **prevNext = &amp;agent_nsap_list;
00512   <font class="keywordtype">int</font> handle = 0;
00513   <font class="keywordtype">void</font> *isp = NULL;
00514 
00515   <font class="keywordflow">if</font> (t == NULL) {
00516     <font class="keywordflow">return</font> -1;
00517   }
00518 
00519   DEBUGMSGTL((<font class="stringliteral">"register_agent_nsap"</font>, <font class="stringliteral">"fd %d\n"</font>, t-&gt;sock));
00520 
00521   n = (<a class="code" href="struct__agent__nsap.html">agent_nsap</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="struct__agent__nsap.html">agent_nsap</a>));
00522   <font class="keywordflow">if</font> (n == NULL) {
00523     <font class="keywordflow">return</font> -1;
00524   }
00525   s = (<font class="keyword">struct </font>snmp_session *)malloc(sizeof(struct snmp_session));
00526   <font class="keywordflow">if</font> (s == NULL) {
00527     free(n);
00528     <font class="keywordflow">return</font> -1;
00529   }
00530   memset(s, 0, <font class="keyword">sizeof</font>(<font class="keyword">struct</font> snmp_session));
00531   snmp_sess_init(s);
00532 
00533   <font class="comment">/*  Set up the session appropriately for an agent.  */</font>
00534 
00535   s-&gt;version         = SNMP_DEFAULT_VERSION;
00536   s-&gt;callback        = handle_snmp_packet;
00537   s-&gt;authenticator   = NULL;
00538   s-&gt;flags           = ds_get_int(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a8">DS_AGENT_FLAGS</a>);
00539   s-&gt;isAuthoritative = SNMP_SESS_AUTHORITATIVE;
00540 
00541   sp  = snmp_add(s, t, snmp_check_packet, snmp_check_parse);
00542   <font class="keywordflow">if</font> (sp == NULL) {
00543     free(s);
00544     free(n);
00545     <font class="keywordflow">return</font> -1;
00546   }
00547 
00548   isp = snmp_sess_pointer(sp);
00549   <font class="keywordflow">if</font> (isp == NULL) {    <font class="comment">/*  over-cautious  */</font>
00550     free(s);
00551     free(n);
00552     <font class="keywordflow">return</font> -1;
00553   }
00554 
00555   n-&gt;s    = isp;
00556   n-&gt;t    = t;
00557 
00558   <font class="keywordflow">if</font> (main_session == NULL) {
00559     main_session = snmp_sess_session(isp);
00560   }
00561 
00562   <font class="keywordflow">for</font> (a = agent_nsap_list; a != NULL &amp;&amp; handle+1 &gt;= a-&gt;handle; a = a-&gt;next) {
00563     handle = a-&gt;handle;
00564     prevNext = &amp;(a-&gt;next);
00565   }
00566 
00567   <font class="keywordflow">if</font> (handle &lt; INT_MAX) {
00568     n-&gt;handle = handle + 1;
00569     n-&gt;next   = a;
00570     *prevNext = n;
00571     free(s);
00572     <font class="keywordflow">return</font> n-&gt;handle;
00573   } <font class="keywordflow">else</font> {
00574     free(s);
00575     free(n);
00576     <font class="keywordflow">return</font> -1;
00577   }
00578 }
</pre></div>    </td>
  </tr>
</table>
<a name="a36" doxytag="snmp_agent.c::remove_and_free_agent_snmp_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void remove_and_free_agent_snmp_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00984">984</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00985 {
00986     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a> *a, **prevNext = &amp;agent_session_list;
00987 
00988     DEBUGMSGTL((<font class="stringliteral">"snmp_agent"</font>, <font class="stringliteral">"REMOVE %08p\n"</font>, asp));
00989 
00990     <font class="keywordflow">for</font> (a = agent_session_list; a != NULL; a = *prevNext) {
00991         <font class="keywordflow">if</font> (a == asp) {
00992             *prevNext = a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>;
00993             a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a> = NULL;
00994             <a class="code" href="snmp__agent_8h.html#a30">free_agent_snmp_session</a>(a);
00995             asp = NULL;
00996             <font class="keywordflow">break</font>;
00997         } <font class="keywordflow">else</font> {
00998             prevNext = &amp;(a-&gt;<a class="code" href="structagent__snmp__session.html#m10">next</a>);
00999         }
01000     }
01001 
01002     <font class="keywordflow">if</font> (a == NULL &amp;&amp; asp != NULL) {
01003         <font class="comment">/*  We coulnd't find it on the list, so free it anyway.  */</font>
01004         <a class="code" href="snmp__agent_8h.html#a30">free_agent_snmp_session</a>(asp);
01005     }
01006 }
</pre></div>    </td>
  </tr>
</table>
<a name="a22" doxytag="snmp_agent.c::save_set_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="snmp__agent_8c.html#a9">agent_set_cache</a>* save_set_cache </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00192">192</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l00874">wrap_up_request</a>().
<p>
<div class="fragment"><pre>00193 {
00194     <a class="code" href="structagent__set__cache__s.html">agent_set_cache</a> *ptr;
00195 
00196     ptr = SNMP_MALLOC_TYPEDEF(<a class="code" href="structagent__set__cache__s.html">agent_set_cache</a>);
00197     <font class="keywordflow">if</font> (ptr == NULL )
00198         <font class="keywordflow">return</font> NULL;
00199 
00200     <font class="comment">/* Save the important information */</font>
00201     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m0">transID</a>       = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;transid;
00202     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m1">sess</a>          = asp-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a>;
00203     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m2">treecache</a>     = asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a>;
00204     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m3">treecache_len</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m13">treecache_len</a>;
00205     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m4">treecache_num</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m14">treecache_num</a>;
00206     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m6">agent_data</a>    = asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;agent_data;
00207 
00208     <font class="comment">/* make the agent forget about what we've saved */</font>
00209     asp-&gt;<a class="code" href="structagent__snmp__session.html#m12">treecache</a> = NULL;
00210     asp-&gt;<a class="code" href="structagent__snmp__session.html#m11">reqinfo</a>-&gt;agent_data = NULL;
00211     
00212     ptr-&gt;<a class="code" href="structagent__set__cache__s.html#m7">next</a> = Sets;
00213     Sets = ptr;
00214 
00215     <font class="keywordflow">return</font> ptr;
00216 }
</pre></div>    </td>
  </tr>
</table>
<a name="a53" doxytag="snmp_agent.c::set_all_requests_error"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int set_all_requests_error </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>requests</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>error_value</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01898">1898</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01899                                              {
01900     <font class="keywordflow">while</font>(requests) {
01901         <a class="code" href="snmp__agent_8h.html#a39">set_request_error</a>(reqinfo, requests, error_value);
01902         requests = requests-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>;
01903     }
01904     <font class="keywordflow">return</font> error_value;
01905 }
</pre></div>    </td>
  </tr>
</table>
<a name="a52" doxytag="snmp_agent.c::set_mode_request_error"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int set_mode_request_error </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>request</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>error_value</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01853">1853</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01854                                         {
01855     <font class="keywordflow">if</font> (!request)
01856         <font class="keywordflow">return</font> error_value;
01857 
01858     request-&gt;<a class="code" href="structrequest__info__s.html#m5">processed</a> = 1;
01859 
01860     <font class="keywordflow">switch</font>(error_value) {
01861         <font class="keywordflow">case</font> SNMP_NOSUCHOBJECT:
01862         <font class="keywordflow">case</font> SNMP_NOSUCHINSTANCE:
01863         <font class="keywordflow">case</font> SNMP_ENDOFMIBVIEW:
01864             <font class="comment">/* these are exceptions that should be put in the varbind</font>
01865                in the case of a GET but should be translated for a SET
01866                into a real error status code and put in the request */
01867             <font class="keywordflow">switch</font> (mode) {
01868                 <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a4">MODE_GET</a>:
01869                     request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type = error_value;
01870                     <font class="keywordflow">return</font> error_value;
01871                     
01872                 <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>:
01873                 <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a6">MODE_GETBULK</a>:
01874                     <font class="comment">/* ignore these.  They're illegal to set by the</font>
01875                        client APIs for these modes */
01876                     <font class="keywordflow">return</font> error_value;
01877 
01878                 <font class="keywordflow">default</font>:
01879                     request-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> = SNMP_ERR_NOSUCHNAME; <font class="comment">/* WWW: correct? */</font>
01880                     <font class="keywordflow">return</font> error_value;
01881             }
01882             <font class="keywordflow">break</font>; <font class="comment">/* never get here */</font>
01883 
01884         <font class="keywordflow">default</font>:
01885             <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> &lt; 0) {
01886                 <font class="comment">/* illegal local error code.  translate to generr */</font>
01887                 <font class="comment">/* WWW: full translation map? */</font>
01888                 request-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> = SNMP_ERR_GENERR;
01889             } <font class="keywordflow">else</font> {
01890                 <font class="comment">/* WWW: translations and mode checking? */</font>
01891                 request-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> = error_value;
01892             }
01893             <font class="keywordflow">return</font> error_value;
01894     }
01895     <font class="keywordflow">return</font> error_value;
01896 }
</pre></div>    </td>
  </tr>
</table>
<a name="a51" doxytag="snmp_agent.c::set_request_error"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int set_request_error </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>request</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>error_value</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01845">1845</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01846                                         {
01847     <font class="keywordflow">if</font> (!request || !reqinfo)
01848         <font class="keywordflow">return</font> error_value;
01849 
01850     <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8h.html#a38">set_mode_request_error</a>(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a>, request, error_value);
01851 }
</pre></div>    </td>
  </tr>
</table>
<a name="a27" doxytag="snmp_agent.c::snmp_addrcache_age"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void snmp_addrcache_age </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00325">325</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmpd_8c-source.html#l00291">main</a>().
<p>
<div class="fragment"><pre>00326 {
00327   <font class="keywordtype">int</font> i = 0;
00328   
00329   lastAddrAge = 0;
00330   <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>; i++) {
00331     <font class="keywordflow">if</font> (<a class="code" href="structaddrCache.html">addrCache</a>[i].status == SNMP_ADDRCACHE_OLD) {
00332       <a class="code" href="structaddrCache.html">addrCache</a>[i].status = SNMP_ADDRCACHE_UNUSED;
00333       <font class="keywordflow">if</font> (<a class="code" href="structaddrCache.html">addrCache</a>[i].addr != NULL) {
00334         free(<a class="code" href="structaddrCache.html">addrCache</a>[i].addr);
00335         <a class="code" href="structaddrCache.html">addrCache</a>[i].addr = NULL;
00336       }
00337     }
00338     <font class="keywordflow">if</font> (<a class="code" href="structaddrCache.html">addrCache</a>[i].status == SNMP_ADDRCACHE_USED) {
00339       <a class="code" href="structaddrCache.html">addrCache</a>[i].status = SNMP_ADDRCACHE_OLD;
00340     }
00341   }
00342 }
</pre></div>    </td>
  </tr>
</table>
<a name="a26" doxytag="snmp_agent.c::snmp_addrcache_initialise"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void snmp_addrcache_initialise </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00311">311</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmpd_8c-source.html#l00291">main</a>().
<p>
<div class="fragment"><pre>00312 {
00313   <font class="keywordtype">int</font> i = 0;
00314   
00315   <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>; i++) {
00316     <a class="code" href="structaddrCache.html">addrCache</a>[i].addr = NULL;
00317     <a class="code" href="structaddrCache.html">addrCache</a>[i].status = SNMP_ADDRCACHE_UNUSED;
00318   }
00319 }
</pre></div>    </td>
  </tr>
</table>
<a name="a28" doxytag="snmp_agent.c::snmp_check_packet"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int snmp_check_packet </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>session</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>snmp_transport *&nbsp;</td>
          <td class="mdname">&nbsp; <em>transport</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname">&nbsp; <em>transport_data</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>transport_data_length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00361">361</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00363 {
00364   <font class="keywordtype">char</font> *addr_string = NULL;
00365   <font class="keywordtype">int</font> i = 0;
00366 
00367   <font class="comment">/*</font>
00368    * Log the message and/or dump the message.
00369    * Optionally cache the network address of the sender.
00370    */
00371 
00372   <font class="keywordflow">if</font> (transport != NULL &amp;&amp; transport-&gt;f_fmtaddr != NULL) {
00373     <font class="comment">/*  Okay I do know how to format this address for logging.  */</font>
00374     addr_string = transport-&gt;f_fmtaddr(transport, transport_data,
00375                                        transport_data_length);
00376     <font class="comment">/*  Don't forget to free() it.  */</font>
00377   } <font class="keywordflow">else</font> {
00378     <font class="comment">/*  Don't know how to format the address for logging.  */</font>
00379     addr_string = strdup(<font class="stringliteral">"&lt;UNKNOWN&gt;"</font>);
00380   }
00381 
00382 <font class="preprocessor">#ifdef  USE_LIBWRAP</font>
00383   <font class="keywordflow">if</font> (hosts_ctl(<font class="stringliteral">"snmpd"</font>, addr_string, addr_string, STRING_UNKNOWN))<font class="keyword"> </font>{
00384     snmp_log(allow_severity, <font class="stringliteral">"Connection from %s\n"</font>, addr_string);
00385   } <font class="keywordflow">else</font> {
00386     snmp_log(deny_severity, <font class="stringliteral">"Connection from %s REFUSED\n"</font>, addr_string);
00387     <font class="keywordflow">if</font> (addr_string != NULL) {
00388       free(addr_string);
00389     }
00390     <font class="keywordflow">return</font> 0;
00391   }
00392 <font class="preprocessor">#endif</font><font class="comment">/*USE_LIBWRAP*/</font>
00393 
00394   snmp_increment_statistic(STAT_SNMPINPKTS);
00395 
00396   <font class="keywordflow">if</font> (log_addresses || ds_get_boolean(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a0">DS_AGENT_VERBOSE</a>))<font class="keyword"> </font>{
00397     
00398     <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>; i++) {
00399       <font class="keywordflow">if</font> ((<a class="code" href="structaddrCache.html">addrCache</a>[i].status != SNMP_ADDRCACHE_UNUSED) &amp;&amp;
00400           (strcmp(<a class="code" href="structaddrCache.html">addrCache</a>[i].addr, addr_string) == 0)) {
00401         <font class="keywordflow">break</font>;
00402       }
00403     }
00404 
00405     <font class="keywordflow">if</font> (i &gt;= <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a> ||
00406         ds_get_boolean(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a0">DS_AGENT_VERBOSE</a>))<font class="keyword"></font>{
00407       <font class="comment">/*  Address wasn't in the cache, so log the packet...  */</font>
00408       snmp_log(LOG_INFO, <font class="stringliteral">"Received SNMP packet(s) from %s\n"</font>, addr_string);
00409       <font class="comment">/*  ...and try to cache the address.  */</font>
00410       <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>; i++) {
00411         <font class="keywordflow">if</font> (<a class="code" href="structaddrCache.html">addrCache</a>[i].status == SNMP_ADDRCACHE_UNUSED) {
00412           <font class="keywordflow">if</font> (<a class="code" href="structaddrCache.html">addrCache</a>[i].addr != NULL) {
00413             free(<a class="code" href="structaddrCache.html">addrCache</a>[i].addr);
00414           }
00415           <a class="code" href="structaddrCache.html">addrCache</a>[i].addr   = addr_string;
00416           <a class="code" href="structaddrCache.html">addrCache</a>[i].status = SNMP_ADDRCACHE_USED;
00417           addr_string         = NULL;   <font class="comment">/* Don't free this 'temporary' string</font>
00418                                            since it's now part of the cache */
00419           <font class="keywordflow">break</font>;
00420         }
00421       }
00422       <font class="keywordflow">if</font> (i &gt;= <a class="code" href="snmp__agent_8c.html#a1">SNMP_ADDRCACHE_SIZE</a>) {
00423         <font class="comment">/*  We didn't find a free slot to cache the address.  Perhaps we</font>
00424             should be using an LRU replacement policy here or something.  Oh
00425             well.  */
00426         DEBUGMSGTL((<font class="stringliteral">"snmp_check_packet"</font>, <font class="stringliteral">"cache overrun"</font>));
00427       }
00428     } <font class="keywordflow">else</font> {
00429       <a class="code" href="structaddrCache.html">addrCache</a>[i].status = SNMP_ADDRCACHE_USED;
00430     }
00431   }
00432 
00433   <font class="keywordflow">if</font> (addr_string != NULL) {
00434     free(addr_string);
00435     addr_string = NULL;
00436   }
00437   <font class="keywordflow">return</font> 1;
00438 }
</pre></div>    </td>
  </tr>
</table>
<a name="a14" doxytag="snmp_agent.c::snmp_check_packet"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int snmp_check_packet </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp;, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct _snmp_transport *&nbsp;</td>
          <td class="mdname">&nbsp;, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname">&nbsp;, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a name="a15" doxytag="snmp_agent.c::snmp_check_parse"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int snmp_check_parse </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>session</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_pdu *&nbsp;</td>
          <td class="mdname">&nbsp; <em>pdu</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>result</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00441">441</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>00443 {
00444   <font class="keywordflow">if</font> (result == 0) {
00445     <font class="keywordflow">if</font> (ds_get_boolean(DS_APPLICATION_ID, <a class="code" href="ds__agent_8h.html#a0">DS_AGENT_VERBOSE</a>) &amp;&amp;
00446         snmp_get_do_logging())<font class="keyword"> </font>{
00447       <font class="keyword">struct </font>variable_list *var_ptr;
00448             
00449       <font class="keywordflow">switch</font> (pdu-&gt;command) {
00450       <font class="keywordflow">case</font> SNMP_MSG_GET:
00451         snmp_log(LOG_DEBUG, <font class="stringliteral">"  GET message\n"</font>); <font class="keywordflow">break</font>;
00452       <font class="keywordflow">case</font> SNMP_MSG_GETNEXT:
00453         snmp_log(LOG_DEBUG, <font class="stringliteral">"  GETNEXT message\n"</font>); <font class="keywordflow">break</font>;
00454       <font class="keywordflow">case</font> SNMP_MSG_RESPONSE:
00455         snmp_log(LOG_DEBUG, <font class="stringliteral">"  RESPONSE message\n"</font>); <font class="keywordflow">break</font>;
00456       <font class="keywordflow">case</font> SNMP_MSG_SET:
00457         snmp_log(LOG_DEBUG, <font class="stringliteral">"  SET message\n"</font>); <font class="keywordflow">break</font>;
00458       <font class="keywordflow">case</font> SNMP_MSG_TRAP:
00459         snmp_log(LOG_DEBUG, <font class="stringliteral">"  TRAP message\n"</font>); <font class="keywordflow">break</font>;
00460       <font class="keywordflow">case</font> SNMP_MSG_GETBULK:
00461         snmp_log(LOG_DEBUG, <font class="stringliteral">"  GETBULK message, non-rep=%d, max_rep=%d\n"</font>,
00462                  pdu-&gt;errstat, pdu-&gt;errindex); <font class="keywordflow">break</font>;
00463       <font class="keywordflow">case</font> SNMP_MSG_INFORM:
00464         snmp_log(LOG_DEBUG, <font class="stringliteral">"  INFORM message\n"</font>); <font class="keywordflow">break</font>;
00465       <font class="keywordflow">case</font> SNMP_MSG_TRAP2:
00466         snmp_log(LOG_DEBUG, <font class="stringliteral">"  TRAP2 message\n"</font>); <font class="keywordflow">break</font>;
00467       <font class="keywordflow">case</font> SNMP_MSG_REPORT:
00468         snmp_log(LOG_DEBUG, <font class="stringliteral">"  REPORT message\n"</font>); <font class="keywordflow">break</font>;
00469       }
00470              
00471       <font class="keywordflow">for</font> (var_ptr = pdu-&gt;variables; var_ptr != NULL;
00472            var_ptr=var_ptr-&gt;next_variable) {
00473         size_t c_oidlen = 256, c_outlen = 0;
00474         u_char *c_oid = (u_char *)malloc(c_oidlen);
00475 
00476         <font class="keywordflow">if</font> (c_oid) {
00477           <font class="keywordflow">if</font> (!sprint_realloc_objid(&amp;c_oid, &amp;c_oidlen, &amp;c_outlen, 1,
00478                                     var_ptr-&gt;name, var_ptr-&gt;name_length))<font class="keyword"> </font>{
00479             snmp_log(LOG_DEBUG, <font class="stringliteral">"    -- %s [TRUNCATED]\n"</font>, c_oid);
00480           } <font class="keywordflow">else</font> {
00481             snmp_log(LOG_DEBUG, <font class="stringliteral">"    -- %s\n"</font>, c_oid);
00482           }
00483           free(c_oid);
00484         }
00485       }
00486     }
00487     <font class="keywordflow">return</font> 1;
00488   }
00489   <font class="keywordflow">return</font> 0; <font class="comment">/* XXX: does it matter what the return value is?  Yes: if we</font>
00490                return 0, then the PDU is dumped.  */
00491 }
</pre></div>    </td>
  </tr>
</table>
<a name="a55" doxytag="snmp_agent.c::timeval_uptime"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int timeval_uptime </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct timeval *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>tv</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01921">1921</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.<div class="fragment"><pre>01922 {
01923     <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8h.html#a41">marker_uptime</a>((marker_t)tv);
01924 }
</pre></div>    </td>
  </tr>
</table>
<a name="a18" doxytag="snmp_agent.c::wrap_up_request"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int wrap_up_request </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>asp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>status</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00874">874</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.
<p>
Referenced by <a class="el" href="snmp__agent_8c-source.html#l01501">check_delayed_request</a>(), and <a class="el" href="snmp__agent_8c-source.html#l01030">handle_snmp_packet</a>().
<p>
<div class="fragment"><pre>00874                                                             {
00875     <font class="keyword">struct </font>variable_list *var_ptr;
00876     <font class="keywordtype">int</font> i;
00877 
00878     <font class="comment">/* some stuff needs to be saved in special subagent cases */</font>
00879     <font class="keywordflow">switch</font>(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command) {
00880         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_BEGIN:
00881         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE1:
00882         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_RESERVE2:
00883         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_ACTION:
00884         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_COMMIT:
00885         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_FREE:
00886         <font class="keywordflow">case</font> SNMP_MSG_INTERNAL_SET_UNDO:
00887             <a class="code" href="snmp__agent_8c.html#a22">save_set_cache</a>(asp);
00888             <font class="keywordflow">break</font>;
00889     }
00890     
00891     <font class="comment">/*</font>
00892      * May need to "dumb down" a SET error status for a
00893      * v1 query.  See RFC2576 - section 4.3
00894      */
00895     <font class="keywordflow">if</font> (( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>                          ) &amp;&amp;
00896         ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command == SNMP_MSG_SET ) &amp;&amp;
00897         ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;version == SNMP_VERSION_1 )) {
00898         <font class="keywordflow">switch</font> ( status ) {
00899             <font class="keywordflow">case</font> SNMP_ERR_WRONGVALUE:
00900             <font class="keywordflow">case</font> SNMP_ERR_WRONGENCODING:
00901             <font class="keywordflow">case</font> SNMP_ERR_WRONGTYPE:
00902             <font class="keywordflow">case</font> SNMP_ERR_WRONGLENGTH:
00903             <font class="keywordflow">case</font> SNMP_ERR_INCONSISTENTVALUE:
00904                 status = SNMP_ERR_BADVALUE;
00905                 <font class="keywordflow">break</font>;
00906             <font class="keywordflow">case</font> SNMP_ERR_NOACCESS:
00907             <font class="keywordflow">case</font> SNMP_ERR_NOTWRITABLE:
00908             <font class="keywordflow">case</font> SNMP_ERR_NOCREATION:
00909             <font class="keywordflow">case</font> SNMP_ERR_INCONSISTENTNAME:
00910             <font class="keywordflow">case</font> SNMP_ERR_AUTHORIZATIONERROR:
00911                 status = SNMP_ERR_NOSUCHNAME;
00912                 <font class="keywordflow">break</font>;
00913             <font class="keywordflow">case</font> SNMP_ERR_RESOURCEUNAVAILABLE:
00914             <font class="keywordflow">case</font> SNMP_ERR_COMMITFAILED:
00915             <font class="keywordflow">case</font> SNMP_ERR_UNDOFAILED:
00916                 status = SNMP_ERR_GENERR;
00917                 <font class="keywordflow">break</font>;
00918         }
00919     }
00920     <font class="comment">/*</font>
00921      * Similarly we may need to "dumb down" v2 exception
00922      *  types to throw an error for a v1 query.
00923      *  See RFC2576 - section 4.1.2.3
00924      */
00925     <font class="keywordflow">if</font> (( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>                          ) &amp;&amp;
00926         ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command != SNMP_MSG_SET ) &amp;&amp;
00927         ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;version == SNMP_VERSION_1 )) {
00928         <font class="keywordflow">for</font> ( var_ptr = asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables, i=1 ;
00929               var_ptr != NULL ;
00930               var_ptr = var_ptr-&gt;next_variable, i++ ) {
00931             <font class="keywordflow">switch</font> ( var_ptr-&gt;type ) {
00932                 <font class="keywordflow">case</font> SNMP_NOSUCHOBJECT:
00933                 <font class="keywordflow">case</font> SNMP_NOSUCHINSTANCE:
00934                 <font class="keywordflow">case</font> SNMP_ENDOFMIBVIEW:
00935                 <font class="keywordflow">case</font> ASN_COUNTER64:
00936                     status = SNMP_ERR_NOSUCHNAME;
00937                     asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a>=i;
00938                     <font class="keywordflow">break</font>;
00939             }
00940         }
00941     }
00942     <font class="keywordflow">if</font> (( status == SNMP_ERR_NOERROR ) &amp;&amp; ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> )) {
00943         snmp_increment_statistic_by(
00944             (asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command == SNMP_MSG_SET ?
00945              STAT_SNMPINTOTALSETVARS : STAT_SNMPINTOTALREQVARS ),
00946             count_varbinds( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;variables ));
00947     }
00948     <font class="keywordflow">else</font> {
00949         <font class="comment">/*</font>
00950          * Use a copy of the original request
00951          *   to report failures.
00952          */
00953         snmp_free_pdu( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> );
00954         asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> = asp-&gt;<a class="code" href="structagent__snmp__session.html#m5">orig_pdu</a>;
00955         asp-&gt;<a class="code" href="structagent__snmp__session.html#m5">orig_pdu</a> = NULL;
00956     }
00957     <font class="keywordflow">if</font> ( asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> ) {
00958         asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;command  = SNMP_MSG_RESPONSE;
00959         asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;errstat  = asp-&gt;<a class="code" href="structagent__snmp__session.html#m8">status</a>;
00960         asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>-&gt;errindex = asp-&gt;<a class="code" href="structagent__snmp__session.html#m9">index</a>;
00961         <font class="keywordflow">if</font> (! snmp_send( asp-&gt;<a class="code" href="structagent__snmp__session.html#m3">session</a>, asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> ))
00962             snmp_free_pdu(asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a>);
00963         snmp_increment_statistic(STAT_SNMPOUTPKTS);
00964         snmp_increment_statistic(STAT_SNMPOUTGETRESPONSES);
00965         asp-&gt;<a class="code" href="structagent__snmp__session.html#m4">pdu</a> = NULL;
00966         <a class="code" href="snmp__agent_8h.html#a31">remove_and_free_agent_snmp_session</a>(asp);
00967     }
00968     <font class="keywordflow">return</font> 1;
00969 }
</pre></div>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a8" doxytag="snmp_agent.c::agent_delegated_list"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a>* agent_delegated_list = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00136">136</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<a name="a3" doxytag="snmp_agent.c::lastAddrAge"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int lastAddrAge = 0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00122">122</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<a name="a4" doxytag="snmp_agent.c::log_addresses"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int log_addresses = 0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00123">123</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<a name="a11" doxytag="snmp_agent.c::main_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct snmp_session* main_session = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l00500">500</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<a name="a12" doxytag="snmp_agent.c::starttime"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct timeval starttime
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="snmp__agent_8c-source.html#l01907">1907</a> of file <a class="el" href="snmp__agent_8c-source.html">snmp_agent.c</a>.    </td>
  </tr>
</table>
<hr><address><small>Generated on Sat Nov 10 14:09:56 2001 for net-snmp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
<!--#include virtual="/sfbutton.html" -->
<!--#include virtual="/sfbutton.html" -->
<!-- CONTENT END -->