---
section: development
---
<!-- CONTENT START -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>old_api.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>old_api.c File Reference</h1><code>#include &lt;<a class="el" href="config_8h-source.html">config.h</a>&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include "mibincl.h"</code><br>
<code>#include "tools.h"</code><br>
<code>#include "<a class="el" href="snmp__agent_8h-source.html">snmp_agent.h</a>"</code><br>
<code>#include "<a class="el" href="old__api_8h-source.html">old_api.h</a>"</code><br>
<code>#include &lt;dmalloc.h&gt;</code><br>

<p>
<a href="old__api_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td nowrap align=right valign=top>#define&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a0">MIB_CLIENTS_ARE_EVIL</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a2">get_current_agent_session</a> ()</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a3">set_current_agent_session</a> (struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *asp)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a4">get_old_api_handler</a> (void)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a5">register_old_api</a> (const char *moduleName, struct <a class="el" href="structvariable.html">variable</a> *var, size_t varsize, size_t numvars, oid *mibloc, size_t mibloclen, int priority, int range_subid, oid range_ubound, struct snmp_session *ss, const char *context, int timeout, int flags)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="old__api_8c.html#a6">old_api_helper</a> (<a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *handler, <a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *reqinfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *requests)</td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a name="a0" doxytag="old_api.c::MIB_CLIENTS_ARE_EVIL"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MIB_CLIENTS_ARE_EVIL&nbsp;&nbsp;&nbsp;1
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00018">18</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a2" doxytag="old_api.c::get_current_agent_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a>* get_current_agent_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00022">22</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.<div class="fragment"><pre>00022                             {
00023     <font class="keywordflow">return</font> current_agent_session;
00024 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="old_api.c::get_old_api_handler"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a>* get_old_api_handler </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00032">32</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.
<p>
Referenced by <a class="el" href="old__api_8c-source.html#l00038">register_old_api</a>().
<p>
<div class="fragment"><pre>00032                           {
00033     <font class="keywordflow">return</font> <a class="code" href="helpers_2agent__handler_8h.html#a19">create_handler</a>(<font class="stringliteral">"old_api"</font>, old_api_helper);
00034 }
</pre></div>    </td>
  </tr>
</table>
<a name="a6" doxytag="old_api.c::old_api_helper"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int old_api_helper </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>handler</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>requests</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00097">97</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.<div class="fragment"><pre>00100                                                     {
00101 
00102 <font class="preprocessor">#if MIB_CLIENTS_ARE_EVIL</font>
00103     oid                 save[MAX_OID_LEN];
00104     size_t              savelen = 0;
00105 <font class="preprocessor">#endif</font>
00106     <font class="keyword">struct </font><a class="code" href="structvariable.html">variable</a>     compat_var, *cvp = &amp;compat_var;
00107     <font class="keywordtype">int</font> exact = 1;
00108     <font class="keywordtype">int</font> status;
00109     <font class="keywordtype">int</font> have_delegated = 0;
00110     
00111     <font class="keyword">struct </font><a class="code" href="structvariable.html">variable</a> *vp;
00112     WriteMethod *write_method = NULL;
00113     size_t len;
00114     u_char *access = NULL;
00115     <a class="code" href="structold__opi__cache__s.html">old_api_cache</a> *cacheptr;
00116     AddVarMethod *add_method;
00117     <font class="keyword">struct </font><a class="code" href="structagent__snmp__session.html">agent_snmp_session</a>  *oldasp = NULL;
00118 
00119     vp = (<font class="keyword">struct </font><a class="code" href="structvariable.html">variable</a> *) handler-&gt;myvoid;
00120 
00121     <font class="comment">/* create old variable structure with right information */</font>
00122     memcpy(cvp-&gt;<a class="code" href="structvariable.html#m5">name</a>, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m2">rootoid</a>, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> * <font class="keyword">sizeof</font>(oid));
00123     cvp-&gt;<a class="code" href="structvariable.html#m4">namelen</a> = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>;
00124     cvp-&gt;<a class="code" href="structvariable.html#m1">type</a> = vp-&gt;<a class="code" href="structvariable.html#m1">type</a>;
00125     cvp-&gt;<a class="code" href="structvariable.html#m0">magic</a> = vp-&gt;<a class="code" href="structvariable.html#m0">magic</a>;
00126     cvp-&gt;<a class="code" href="structvariable.html#m2">acl</a> = vp-&gt;<a class="code" href="structvariable.html#m2">acl</a>;
00127     cvp-&gt;<a class="code" href="structvariable.html#m3">findVar</a> = vp-&gt;<a class="code" href="structvariable.html#m3">findVar</a>;
00128 
00129     <font class="keywordflow">switch</font>(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a>) {
00130         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>:
00131         <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a6">MODE_GETBULK</a>:
00132             exact = 0;
00133     }
00134 
00135     <font class="keywordflow">while</font>(requests) {
00136         
00137 <font class="preprocessor">#if MIB_CLIENTS_ARE_EVIL</font>
00138         savelen = requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length;
00139         memcpy(save, requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
00140                savelen*<font class="keyword">sizeof</font>(oid));
00141 <font class="preprocessor">#endif</font>
00142 
00143         <font class="keywordflow">switch</font>(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a>) {
00144             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a4">MODE_GET</a>:
00145             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>:
00146             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a6">MODE_GETBULK</a>:   <font class="comment">/* WWW */</font>
00147             <font class="keywordflow">case</font> <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>:
00148                 <font class="comment">/* Actually call the old mib-module function */</font>
00149                 <font class="keywordflow">if</font> (vp &amp;&amp; vp-&gt;<a class="code" href="structvariable.html#m3">findVar</a>)
00150                     access = (*(vp-&gt;<a class="code" href="structvariable.html#m3">findVar</a>))(cvp, requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
00151                                               &amp;(requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length),
00152                                               exact, &amp;len, &amp;write_method);
00153                 <font class="keywordflow">else</font>
00154                     access = NULL;
00155 
00156 <font class="preprocessor">#ifdef WWW_FIX</font>
00157                 <font class="keywordflow">if</font> (IS_DELEGATED(cvp-&gt;<a class="code" href="structvariable.html#m1">type</a>))<font class="keyword"> </font>{
00158                     add_method = (AddVarMethod*)statP;
00159                     requests-&gt;delayed = 1;
00160                     have_delegated = 1;
00161                     <font class="keywordflow">continue</font>; <font class="comment">/* WWW: This may not get to the right place */</font>
00162                 }
00163 <font class="preprocessor">#endif</font>
00164 
00165                 <font class="comment">/* WWW: end range checking */</font>
00166                 <font class="keywordflow">if</font> (access) {
00167                     <font class="comment">/* result returned */</font>
00168                     <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>)
00169                         snmp_set_var_typed_value(requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>,
00170                                                  cvp-&gt;<a class="code" href="structvariable.html#m1">type</a>, access, len);
00171                 } <font class="keywordflow">else</font> {
00172                     <font class="comment">/* no result returned */</font>
00173 <font class="preprocessor">#if MIB_CLIENTS_ARE_EVIL</font>
00174                     <font class="keywordflow">if</font> (access == NULL) {
00175                         <font class="keywordflow">if</font> (snmp_oid_compare(requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
00176                                              requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length,
00177                                              save, savelen) != 0)<font class="keyword"> </font>{
00178                             snmp_log(LOG_WARNING, <font class="stringliteral">"evil_client: %s\n"</font>,
00179                                      reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m0">handlerName</a>);
00180                             memcpy(requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name, save,
00181                                    savelen*<font class="keyword">sizeof</font>(oid));
00182                             requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length = savelen;
00183                         }
00184                     }
00185 <font class="preprocessor">#endif</font>
00186                 }
00187 
00188                 <font class="comment">/* AAA: fall through for everything that is a set (see BBB) */</font>
00189                 <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a9">MODE_SET_RESERVE1</a>)
00190                     <font class="keywordflow">break</font>;
00191 
00192                 cacheptr = SNMP_MALLOC_TYPEDEF(<a class="code" href="structold__opi__cache__s.html">old_api_cache</a>);
00193                 <font class="keywordflow">if</font> (!cacheptr)
00194                     <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8h.html#a39">set_request_error</a>(reqinfo, requests,
00195                                              SNMP_ERR_RESOURCEUNAVAILABLE);
00196                 cacheptr-&gt;<a class="code" href="structold__opi__cache__s.html#m0">data</a> = access;
00197                 cacheptr-&gt;<a class="code" href="structold__opi__cache__s.html#m1">write_method</a> = write_method;
00198                 <a class="code" href="helpers_2agent__handler_8h.html#a23">request_add_list_data</a>(requests,
00199                                       create_data_list(<a class="code" href="old__api_8h.html#a0">OLD_API_NAME</a>, cacheptr,
00200                                                        free));
00201                 <font class="comment">/* BBB: fall through for everything that is a set (see AAA) */</font>
00202                 
00203             <font class="keywordflow">default</font>:
00204                 <font class="comment">/* WWW: explicitly list the SET conditions */</font>
00205                 <font class="comment">/* (the rest of the) SET contions */</font>
00206                 cacheptr =
00207                     (<a class="code" href="structold__opi__cache__s.html">old_api_cache</a> *) <a class="code" href="helpers_2agent__handler_8h.html#a24">request_get_list_data</a>(requests,
00208                                                             <a class="code" href="old__api_8h.html#a0">OLD_API_NAME</a>);
00209 
00210                 <font class="keywordflow">if</font> (cacheptr == NULL || cacheptr-&gt;<a class="code" href="structold__opi__cache__s.html#m1">write_method</a> == NULL) {
00211                     <font class="comment">/* WWW: try to set ourselves if possible? */</font>
00212                     <font class="keywordflow">return</font> <a class="code" href="snmp__agent_8h.html#a39">set_request_error</a>(reqinfo, requests,
00213                                              SNMP_ERR_NOTWRITABLE);
00214                 }
00215 
00216                 oldasp = <a class="code" href="snmp__agent_8h.html#a36">get_current_agent_session</a>();
00217                 <a class="code" href="old__api_8c.html#a3">set_current_agent_session</a>(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m2">asp</a>);
00218                 status =
00219                     (*(cacheptr-&gt;<a class="code" href="structold__opi__cache__s.html#m1">write_method</a>))(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a>,
00220                                                 requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;val.string,
00221                                                 requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;type,
00222                                                 requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;val_len,
00223                                                 cacheptr-&gt;<a class="code" href="structold__opi__cache__s.html#m0">data</a>,
00224                                                 requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
00225                                                 requests-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length);
00226                 <a class="code" href="old__api_8c.html#a3">set_current_agent_session</a>(oldasp);
00227 
00228                 <font class="keywordflow">if</font> (requests-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a> != SNMP_ERR_NOERROR)
00229                     <a class="code" href="snmp__agent_8h.html#a39">set_request_error</a>(reqinfo, requests, status);
00230 
00231                 <font class="comment">/* clean up is done by the automatic freeing of the</font>
00232                    cache stored in the request. */
00233 
00234                 <font class="keywordflow">break</font>;
00235         }
00236         requests = requests-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>;
00237     }
00238     <font class="keywordflow">return</font> SNMP_ERR_NOERROR;
00239 }
</pre></div>    </td>
  </tr>
</table>
<a name="a5" doxytag="old_api.c::register_old_api"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int register_old_api </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>moduleName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structvariable.html">variable</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>var</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>varsize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>numvars</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>oid *&nbsp;</td>
          <td class="mdname">&nbsp; <em>mibloc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>mibloclen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>priority</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>range_subid</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>oid&nbsp;</td>
          <td class="mdname">&nbsp; <em>range_ubound</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>ss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>context</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>timeout</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00038">38</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.<div class="fragment"><pre>00050                             {
00051     
00052     <a class="code" href="structold__api__info__s.html">old_api_info</a> *old_info = SNMP_MALLOC_TYPEDEF(<a class="code" href="structold__api__info__s.html">old_api_info</a>);
00053     <font class="keywordtype">int</font> i;
00054     
00055     old_info-&gt;<a class="code" href="structold__api__info__s.html#m0">var</a> = var;
00056     old_info-&gt;<a class="code" href="structold__api__info__s.html#m1">varsize</a> = varsize;
00057     old_info-&gt;<a class="code" href="structold__api__info__s.html#m2">numvars</a> = numvars;
00058     old_info-&gt;<a class="code" href="structold__api__info__s.html#m3">ss</a> = ss;
00059     old_info-&gt;<a class="code" href="structold__api__info__s.html#m4">flags</a> = flags;
00060     
00061     <font class="comment">/* register all subtree nodes */</font>
00062     <font class="keywordflow">for</font>(i = 0; i &lt; numvars; i++) {
00063         <font class="keyword">struct </font><a class="code" href="structvariable.html">variable</a> *vp;
00064         <a class="code" href="structhandler__registration__s.html">handler_registration</a> *reginfo =
00065             SNMP_MALLOC_TYPEDEF(<a class="code" href="structhandler__registration__s.html">handler_registration</a>);
00066 
00067         memdup((<font class="keywordtype">void</font> *) &amp;vp,
00068                (<font class="keywordtype">void</font> *) (<font class="keyword">struct</font> <a class="code" href="structvariable.html">variable</a> *) ((<font class="keywordtype">char</font> *) var + varsize*i),
00069                varsize);
00070  
00071         reginfo-&gt;handler = <a class="code" href="old__api_8c.html#a4">get_old_api_handler</a>();
00072         reginfo-&gt;handlerName = strdup(moduleName);
00073         reginfo-&gt;rootoid_len = (mibloclen + vp-&gt;<a class="code" href="structvariable.html#m4">namelen</a>);
00074         reginfo-&gt;rootoid =
00075             (oid *) malloc(reginfo-&gt;rootoid_len * <font class="keyword">sizeof</font>(oid));
00076         
00077         memcpy(reginfo-&gt;rootoid, mibloc, mibloclen*<font class="keyword">sizeof</font>(oid));
00078         memcpy(reginfo-&gt;rootoid + mibloclen, vp-&gt;<a class="code" href="structvariable.html#m5">name</a>, vp-&gt;<a class="code" href="structvariable.html#m4">namelen</a>
00079                * <font class="keyword">sizeof</font>(oid));
00080         reginfo-&gt;handler-&gt;myvoid = (<font class="keywordtype">void</font> *) vp;
00081 
00082         reginfo-&gt;priority = priority;
00083         reginfo-&gt;range_subid = range_subid;
00084         
00085         reginfo-&gt;range_ubound = range_ubound;
00086         reginfo-&gt;timeout = timeout;
00087         reginfo-&gt;contextName = (context) ? strdup(context) : NULL;
00088         reginfo-&gt;modes = HANDLER_CAN_RWRITE;
00089 
00090         <font class="comment">/* register ourselves in the mib tree */</font>
00091         <a class="code" href="helpers_2agent__handler_8h.html#a12">register_handler</a>(reginfo);
00092     }
00093     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
00094 }
</pre></div>    </td>
  </tr>
</table>
<a name="a3" doxytag="old_api.c::set_current_agent_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void set_current_agent_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>asp</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00027">27</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.
<p>
Referenced by <a class="el" href="old__api_8c-source.html#l00097">old_api_helper</a>().
<p>
<div class="fragment"><pre>00027                                                            {
00028     current_agent_session = asp;
00029 }
</pre></div>    </td>
  </tr>
</table>
<hr><address><small>Generated on Sat Nov 10 14:09:55 2001 for net-snmp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
<!--#include virtual="/sfbutton.html" -->
<!--#include virtual="/sfbutton.html" -->
<!-- CONTENT END -->