---
section: development
---
<!-- CONTENT START -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>table.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>table.c File Reference</h1><code>#include &lt;<a class="el" href="config_8h-source.html">config.h</a>&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;assert.h&gt;</code><br>
<code>#include "mibincl.h"</code><br>
<code>#include "tools.h"</code><br>
<code>#include "<a class="el" href="snmp__agent_8h-source.html">snmp_agent.h</a>"</code><br>
<code>#include "<a class="el" href="table_8h-source.html">table.h</a>"</code><br>
<code>#include &lt;dmalloc.h&gt;</code><br>

<p>
<a href="table_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a0">get_table_handler</a> (<a class="el" href="table_8h.html#a11">table_registration_info</a> *tabreq)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a1">register_table</a> (<a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="table_8h.html#a11">table_registration_info</a> *tabreq)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a2">table_data_free_func</a> (void *data)</td></tr>
<tr><td nowrap align=right valign=top>unsigned int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a4">closest_column</a> (unsigned int current, <a class="el" href="table_8h.html#a8">column_info</a> *valid_columns)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a5">table_helper_handler</a> (<a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *handler, <a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *reqinfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *requests)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a6">table_build_oid</a> (<a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *reqinfo, <a class="el" href="table_8h.html#a12">table_request_info</a> *table_info)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>for loop.</em> <a href="#a6">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a7">table_build_oid_from_index</a> (<a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *reqinfo, <a class="el" href="table_8h.html#a12">table_request_info</a> *table_info)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>.column.</em> <a href="#a7">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a8">table_build_result</a> (<a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo, <a class="el" href="snmp__agent_8h.html#a18">request_info</a> *reqinfo, <a class="el" href="table_8h.html#a12">table_request_info</a> *table_info, u_char type, u_char *result, size_t result_len)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a9">update_variable_list_from_index</a> (<a class="el" href="table_8h.html#a12">table_request_info</a> *tri)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a10">update_indexes_from_variable_list</a> (<a class="el" href="table_8h.html#a12">table_request_info</a> *tri)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a11">check_getnext_reply</a> (<a class="el" href="snmp__agent_8h.html#a18">request_info</a> *request, oid *prefix, size_t prefix_len, struct variable_list *newvar, struct variable_list **outvar)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>checks the original request against the current data being passed in if its greater than the request oid but less than the current valid return, set the current valid return to the new value.</em> <a href="#a11">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a12">extract_table_info</a> (<a class="el" href="snmp__agent_8h.html#a18">request_info</a> *request)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="table_8h.html#a11">table_registration_info</a> *&nbsp;</td><td valign=bottom><a class="el" href="table_8c.html#a13">find_table_registration_info</a> (<a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *reginfo)</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a11" doxytag="table.c::check_getnext_reply"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int check_getnext_reply </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>request</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>oid *&nbsp;</td>
          <td class="mdname">&nbsp; <em>prefix</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>prefix_len</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct variable_list *&nbsp;</td>
          <td class="mdname">&nbsp; <em>newvar</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct variable_list **&nbsp;</td>
          <td class="mdname">&nbsp; <em>outvar</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
checks the original request against the current data being passed in if its greater than the request oid but less than the current valid return, set the current valid return to the new value.
<p>
returns 1 if outvar was replaced with the oid from newvar (success). returns 0 if not. 
<p>
Definition at line <a class="el" href="table_8c-source.html#l00532">532</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00537 {
00538     <font class="keyword">static</font> oid      myname[MAX_OID_LEN];
00539     <font class="keyword">static</font> <font class="keywordtype">int</font>      myname_len;
00540 
00541     build_oid_noalloc(myname, MAX_OID_LEN, &amp;myname_len,
00542                       prefix, prefix_len, newvar);
00543     <font class="comment">/*</font>
00544      * is the build of the new indexes less than our current result 
00545      */
00546     <font class="keywordflow">if</font> ((!(*outvar) || snmp_oid_compare(myname + prefix_len,
00547                                         myname_len - prefix_len,
00548                                         (*outvar)-&gt;name + prefix_len,
00549                                         (*outvar)-&gt;name_length - prefix_len) &lt;
00550          0)) {
00551         <font class="comment">/*</font>
00552          * and greater than the requested oid 
00553          */
00554         <font class="keywordflow">if</font> (snmp_oid_compare(myname, myname_len,
00555                              request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name,
00556                              request-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>-&gt;name_length) &gt; 0)<font class="keyword"> </font>{
00557             <font class="comment">/*</font>
00558              * the new result must be better than the old 
00559              */
00560             <font class="keywordflow">if</font> (!*outvar)
00561                 *outvar = snmp_clone_varbind(newvar);
00562             snmp_set_var_objid(*outvar, myname, myname_len);
00563 
00564             <font class="keywordflow">return</font> 1;
00565         }
00566     }
00567     <font class="keywordflow">return</font> 0;
00568 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="table.c::closest_column"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> unsigned int closest_column </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname">&nbsp; <em>current</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a8">column_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>valid_columns</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00078">78</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00079 {
00080     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>    closest = 0;
00081     <font class="keywordtype">char</font>            done = 0;
00082     <font class="keywordtype">char</font>            idx;
00083 
00084     <font class="keywordflow">if</font>(valid_columns == NULL)
00085         <font class="keywordflow">return</font> 0;
00086 
00087     <font class="keywordflow">do</font> {
00088 
00089         <font class="keywordflow">if</font> (valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m0">isRange</a>) {
00090 
00091             <font class="keywordflow">if</font> (current &lt; valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.range[0]) {
00092                 <font class="keywordflow">if</font> (valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.range[0] &lt; closest) {
00093                     closest = valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.range[0];
00094                 }
00095             } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (current &lt;= valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.range[1]) {
00096                 closest = current;
00097                 done = 1;       <font class="comment">/* can not get any closer! */</font>
00098             }
00099 
00100         } <font class="comment">/* range */</font>
00101         <font class="keywordflow">else</font> {                  <font class="comment">/* list */</font>
00102 
00103             <font class="keywordflow">if</font> (current &lt; valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[0]) {
00104                 <font class="keywordflow">if</font> (valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[0] &lt; closest)
00105                     closest = valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[0];
00106                 <font class="keywordflow">continue</font>;
00107             }
00108 
00109             <font class="keywordflow">if</font> (current &gt;
00110                 valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m1">list_count</a>])
00111                 <font class="keywordflow">continue</font>;       <font class="comment">/* not in list range. */</font>
00112 
00113             <font class="keywordflow">for</font> (idx = 0; idx &lt; valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m1">list_count</a>; ++idx) {
00114                 <font class="keywordflow">if</font> (current == valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[idx]) {
00115                     closest = current;
00116                     done = 1;   <font class="comment">/* can not get any closer! */</font>
00117                     <font class="keywordflow">break</font>;      <font class="comment">/* for */</font>
00118                 } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (current &lt; valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[idx]) {
00119                     <font class="keywordflow">if</font> (valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[idx] &lt; closest)
00120                         closest = valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m4">details</a>.list[idx];
00121                     <font class="keywordflow">break</font>;      <font class="comment">/* list should be sorted */</font>
00122                 }
00123             }                   <font class="comment">/* for */</font>
00124 
00125         }                       <font class="comment">/* list */</font>
00126 
00127         valid_columns = valid_columns-&gt;<a class="code" href="structcolumn__info__t.html#m5">next</a>;
00128 
00129     } <font class="keywordflow">while</font> (!done &amp;&amp; valid_columns);
00130 
00131     <font class="keywordflow">return</font> closest;
00132 }
</pre></div>    </td>
  </tr>
</table>
<a name="a12" doxytag="table.c::extract_table_info"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="table_8h.html#a12">table_request_info</a>* extract_table_info </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>request</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00571">571</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00572 {
00573     <font class="keywordflow">return</font> (<a class="code" href="struct__table__request__info.html">table_request_info</a> *)
00574         <a class="code" href="helpers_2agent__handler_8h.html#a24">request_get_list_data</a>(request, <a class="code" href="table_8h.html#a0">TABLE_HANDLER_NAME</a>);
00575 }
</pre></div>    </td>
  </tr>
</table>
<a name="a13" doxytag="table.c::find_table_registration_info"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="table_8h.html#a11">table_registration_info</a>* find_table_registration_info </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>reginfo</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00578">578</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00579 {
00580     <font class="keywordflow">return</font> (<a class="code" href="struct__table__registration__info.html">table_registration_info</a> *)
00581         <a class="code" href="helpers_2agent__handler_8h.html#a15">find_handler_data_by_name</a>(reginfo, <a class="code" href="table_8h.html#a0">TABLE_HANDLER_NAME</a>);
00582 }
</pre></div>    </td>
  </tr>
</table>
<a name="a0" doxytag="table.c::get_table_handler"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a>* get_table_handler </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a11">table_registration_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>tabreq</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00024">24</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00025 {
00026     <a class="code" href="structmib__handler__s.html">mib_handler</a>    *ret = NULL;
00027 
00028     <font class="keywordflow">if</font> (!tabreq) {
00029         snmp_log(LOG_INFO, <font class="stringliteral">"get_table_handler(NULL) called\n"</font>);
00030         <font class="keywordflow">return</font> NULL;
00031     }
00032 
00033     ret = <a class="code" href="helpers_2agent__handler_8h.html#a19">create_handler</a>(<a class="code" href="table_8h.html#a0">TABLE_HANDLER_NAME</a>, table_helper_handler);
00034     <font class="keywordflow">if</font> (ret) {
00035         ret-&gt;<a class="code" href="structmib__handler__s.html#m1">myvoid</a> = (<font class="keywordtype">void</font> *) tabreq;
00036         tabreq-&gt;<a class="code" href="struct__table__registration__info.html#m1">number_indexes</a> = count_varbinds(tabreq-&gt;<a class="code" href="struct__table__registration__info.html#m0">indexes</a>);
00037     }
00038     <font class="keywordflow">return</font> ret;
00039 }
</pre></div>    </td>
  </tr>
</table>
<a name="a1" doxytag="table.c::register_table"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int register_table </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a11">table_registration_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>tabreq</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00043">43</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00045 {
00046     <a class="code" href="helpers_2agent__handler_8h.html#a13">inject_handler</a>(reginfo, <a class="code" href="ttest_8c.html#a0">get_table_handler</a>(tabreq));
00047     <font class="keywordflow">return</font> <a class="code" href="helpers_2agent__handler_8h.html#a12">register_handler</a>(reginfo);
00048 }
</pre></div>    </td>
  </tr>
</table>
<a name="a6" doxytag="table.c::table_build_oid"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int table_build_oid </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>table_info</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
for loop.
<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00435">435</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00437 {
00438     oid             tmpoid[MAX_OID_LEN];
00439     <font class="keyword">struct </font>variable_list *var;
00440 
00441     <font class="keywordflow">if</font> (!reginfo || !reqinfo || !table_info)
00442         <font class="keywordflow">return</font> SNMPERR_GENERR;
00443 
00444     memcpy(tmpoid, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m2">rootoid</a>, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> * <font class="keyword">sizeof</font>(oid));
00445     tmpoid[reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>] = 1;   
00446     tmpoid[reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> + 1] = table_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a>; 
00448     var = reqinfo-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>;
00449     <font class="keywordflow">if</font> (build_oid(&amp;var-&gt;name, &amp;var-&gt;name_length,
00450                   tmpoid, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> + 2, table_info-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>)
00451         != SNMPERR_SUCCESS)
00452         <font class="keywordflow">return</font> SNMPERR_GENERR;
00453 
00454     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
00455 }
</pre></div>    </td>
  </tr>
</table>
<a name="a7" doxytag="table.c::table_build_oid_from_index"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int table_build_oid_from_index </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>table_info</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
.column.
<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00458">458</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00461 {
00462     oid             tmpoid[MAX_OID_LEN];
00463     <font class="keyword">struct </font>variable_list *var;
00464     <font class="keywordtype">int</font>             len;
00465 
00466     <font class="keywordflow">if</font> (!reginfo || !reqinfo || !table_info)
00467         <font class="keywordflow">return</font> SNMPERR_GENERR;
00468 
00469     var = reqinfo-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>;
00470     len = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>;
00471     memcpy(tmpoid, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m2">rootoid</a>, len * <font class="keyword">sizeof</font>(oid));
00472     tmpoid[len++] = 1;          <font class="comment">/* .Entry */</font>
00473     tmpoid[len++] = table_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a>; <font class="comment">/* .column */</font>
00474     memcpy(&amp;tmpoid[len], table_info-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>,
00475            table_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> * <font class="keyword">sizeof</font>(oid));
00476     len += table_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a>;
00477     snmp_clone_mem((<font class="keywordtype">void</font> **) &amp;var-&gt;name, tmpoid, len * <font class="keyword">sizeof</font>(oid));
00478     var-&gt;name_length = len;
00479 
00480     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
00481 }
</pre></div>    </td>
  </tr>
</table>
<a name="a8" doxytag="table.c::table_build_result"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int table_build_result </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>table_info</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_char&nbsp;</td>
          <td class="mdname">&nbsp; <em>type</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>result</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>result_len</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00484">484</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00488 {
00489 
00490     <font class="keyword">struct </font>variable_list *var;
00491 
00492     <font class="keywordflow">if</font> (!reqinfo || !table_info)
00493         <font class="keywordflow">return</font> SNMPERR_GENERR;
00494 
00495     var = reqinfo-&gt;<a class="code" href="structrequest__info__s.html#m0">requestvb</a>;
00496 
00497     <font class="keywordflow">if</font> (var-&gt;name != var-&gt;name_loc)
00498         free(var-&gt;name);
00499     var-&gt;name = NULL;
00500 
00501     <font class="keywordflow">if</font> (<a class="code" href="ttest_8c.html#a5">table_build_oid</a>(reginfo, reqinfo, table_info) != SNMPERR_SUCCESS)
00502         <font class="keywordflow">return</font> SNMPERR_GENERR;
00503 
00504     snmp_set_var_typed_value(var, type, result, result_len);
00505 
00506     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
00507 }
</pre></div>    </td>
  </tr>
</table>
<a name="a2" doxytag="table.c::table_data_free_func"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void table_data_free_func </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>data</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00051">51</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00052 {
00053     <a class="code" href="struct__table__request__info.html">table_request_info</a> *info = (<a class="code" href="struct__table__request__info.html">table_request_info</a> *) data;
00054     <font class="keywordflow">if</font> (!info)
00055         <font class="keywordflow">return</font>;
00056     snmp_free_varbind(info-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>);
00057     free(info);
00058 }
</pre></div>    </td>
  </tr>
</table>
<a name="a5" doxytag="table.c::table_helper_handler"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int table_helper_handler </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a8">mib_handler</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>handler</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="helpers_2agent__handler_8h.html#a9">handler_registration</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reginfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a21">agent_request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>reqinfo</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="snmp__agent_8h.html#a18">request_info</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>requests</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00135">135</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00138 {
00139 
00140     <a class="code" href="structrequest__info__s.html">request_info</a>   *request;
00141 
00142     <a class="code" href="struct__table__registration__info.html">table_registration_info</a> *tbl_info;
00143     <font class="keywordtype">int</font>             oid_index_pos = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> + 2;
00144     <font class="keywordtype">int</font>             oid_column_pos = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> + 1;
00145     <font class="keywordtype">int</font>             tmp_idx, tmp_len;
00146     <font class="keywordtype">int</font>             incomplete, out_of_range;
00147     <font class="keywordtype">int</font>             status = SNMP_ERR_NOERROR, need_processing = 0;
00148     oid            *tmp_name;
00149     <a class="code" href="struct__table__request__info.html">table_request_info</a> *tbl_req_info;
00150     <font class="keyword">struct </font>variable_list *vb;
00151 
00152     tbl_info = (<a class="code" href="struct__table__registration__info.html">table_registration_info</a> *) handler-&gt;<a class="code" href="structmib__handler__s.html#m1">myvoid</a>;
00153 
00154     <font class="keywordflow">if</font> ((!handler-&gt;<a class="code" href="structmib__handler__s.html#m1">myvoid</a>) || (!tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m0">indexes</a>)) {
00155         snmp_log(LOG_INFO, <font class="stringliteral">"improperly registered table found\n"</font>);
00156 
00157         <font class="comment">/*</font>
00158          * XXX-rks: unregister table? 
00159          */
00160         <font class="keywordflow">return</font> SNMP_ERR_GENERR;
00161     }
00162 
00163     DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"Got request for handler %s:\n"</font>,
00164                 handler-&gt;<a class="code" href="structmib__handler__s.html#m0">handler_name</a>));
00165 
00166     <font class="comment">/*</font>
00167      * if the agent request info has a state reference, then this is a 
00168      * later pass of a set request and we can skip all the lookup stuff.
00169      *
00170      * xxx-rks: this might break for handlers which only handle one varbind
00171      * at a time... those handlers should not save data by their handler_name
00172      * in the agent_request_info. 
00173      */
00174     <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8h.html#a50">agent_get_list_data</a>(reqinfo,handler-&gt;<a class="code" href="structmib__handler__s.html#m3">next</a>-&gt;handler_name))<font class="keyword"> </font>{
00175         <font class="keywordflow">if</font> (<a class="code" href="snmp__agent_8h.html#a15">MODE_IS_SET</a>(reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a>))<font class="keyword"> </font>{
00176             <font class="keywordflow">return</font> <a class="code" href="helpers_2agent__handler_8h.html#a18">call_next_handler</a>(handler, reginfo, reqinfo, requests);
00177         } <font class="keywordflow">else</font> {
00178 <font class="preprocessor">#pragma warning "XXX-rks: memory leak. add cleanup handler?"</font>
00179             <a class="code" href="snmp__agent_8h.html#a52">free_agent_data_sets</a>(reqinfo);
00180         }
00181     }
00182 
00183 
00184     <font class="comment">/*</font>
00185      * loop through requests
00186      */
00187 
00188     <font class="keywordflow">for</font> (request = requests; request; request = request-&gt;<a class="code" href="structrequest__info__s.html#m8">next</a>) {
00189         <font class="keyword">struct </font>variable_list *var = request-&gt;requestvb;
00190 
00191         DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"  oid:"</font>));
00192         DEBUGMSGOID((<font class="stringliteral">"helper:table"</font>, var-&gt;name, var-&gt;name_length));
00193         DEBUGMSG((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"\n"</font>));
00194 
00195         <font class="keywordflow">if</font> (request-&gt;<a class="code" href="structrequest__info__s.html#m6">status</a>)
00196             <font class="keywordflow">continue</font>;
00197         ++need_processing;
00198 
00199         <font class="comment">/*</font>
00200          * this should probably be handled further up 
00201          */
00202         <font class="keywordflow">if</font> ((reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> == <a class="code" href="snmp__agent_8h.html#a4">MODE_GET</a>) &amp;&amp; (var-&gt;type != ASN_NULL)) {
00203           <font class="comment">/* valid request if ASN_NULL */</font>
00204             DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>,
00205                         <font class="stringliteral">"  GET var type is not ASN_NULL\n"</font>));
00206             <a class="code" href="snmp__agent_8h.html#a39">set_request_error</a>(reqinfo, request, SNMP_ERR_WRONGTYPE);
00207             <font class="keywordflow">continue</font>;
00208         }
00209 
00210         <font class="comment">/*</font>
00211          * check to make sure its in table range 
00212          */
00213 
00214         out_of_range = 0;
00215         <font class="comment">/*</font>
00216          * if our root oid is &gt; var-&gt;name and this is not a GETNEXT, 
00217          * then the oid is out of range. (only compare up to shorter 
00218          * length) 
00219          */
00220         <font class="keywordflow">if</font> (reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a> &gt; var-&gt;name_length)
00221             tmp_len = var-&gt;name_length;
00222         <font class="keywordflow">else</font>
00223             tmp_len = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>;
00224         <font class="keywordflow">if</font> (snmp_oid_compare(reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m2">rootoid</a>, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>,
00225                              var-&gt;name, tmp_len) &gt; 0)<font class="keyword"> </font>{
00226             <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> == <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) {
00227                 <font class="keywordflow">if</font> (var-&gt;name != var-&gt;name_loc)
00228                     free(var-&gt;name);
00229                 snmp_set_var_objid(var, reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m2">rootoid</a>,
00230                                    reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>);
00231             } <font class="keywordflow">else</font> {
00232                 DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"  oid is out of range.\n"</font>));
00233                 out_of_range = 1;
00234             }
00235         }
00236         <font class="comment">/*</font>
00237          * if var-&gt;name is longer than the root, make sure it is 
00238          * table.1 (table.ENTRY).  
00239          */
00240         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((var-&gt;name_length &gt; reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>) &amp;&amp;
00241                  (var-&gt;name[reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>] != 1)) {
00242             <font class="keywordflow">if</font> ((var-&gt;name[reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>] &lt; 1) &amp;&amp;
00243                 (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> == <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>)) {
00244                 var-&gt;name[reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>] = 1;
00245                 var-&gt;name_length = reginfo-&gt;<a class="code" href="structhandler__registration__s.html#m3">rootoid_len</a>;
00246             } <font class="keywordflow">else</font> {
00247                 out_of_range = 1;
00248                 DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"  oid is out of range.\n"</font>));
00249             }
00250         }
00251         <font class="comment">/*</font>
00252          * if it is not in range, then remove it from the request list 
00253          * because we can't process it. If the request is not a GETNEXT 
00254          * then set the error to NOSUCHOBJECT so nobody else wastes time
00255          * trying to process it.  
00256          */
00257         <font class="keywordflow">if</font> (out_of_range) {
00258             DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"  Not processed.\n"</font>));
00259             <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) {
00260                 table_helper_cleanup(reqinfo, request,
00261                                      SNMP_ERR_NOSUCHNAME);
00262             }
00263             <font class="keywordflow">continue</font>;
00264         }
00265 
00266 
00267         <font class="comment">/*</font>
00268          * * Check column ranges; set-up to pull out indexes from OID. 
00269          */
00270 
00271         incomplete = 0;
00272         tbl_req_info = SNMP_MALLOC_TYPEDEF(<a class="code" href="struct__table__request__info.html">table_request_info</a>);
00273         tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m5">reg_info</a> = tbl_info;
00274         tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a> = snmp_clone_varbind(tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m0">indexes</a>);
00275         tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m1">number_indexes</a> = 0;       <font class="comment">/* none yet */</font>
00276         <font class="keywordflow">if</font> (var-&gt;name_length &gt; oid_column_pos) {
00277             <font class="keywordflow">if</font> (var-&gt;name[oid_column_pos] &lt; tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m2">min_column</a>) {
00278                 <font class="comment">/*</font>
00279                  * fix column, truncate useless index info 
00280                  */
00281                 var-&gt;name_length = oid_column_pos;
00282                 tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> = tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m2">min_column</a>;
00283             } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (var-&gt;name[oid_column_pos] &gt; tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m3">max_column</a>) {
00284                 <font class="comment">/*</font>
00285                  * this is out of range...  remove from requests, free
00286                  * memory 
00287                  */
00288                 DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>,
00289                             <font class="stringliteral">"  oid is out of range. Not processed.\n"</font>));
00290                 <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) {
00291                     table_helper_cleanup(reqinfo, request,
00292                                          SNMP_ERR_NOSUCHNAME);
00293                 }
00294                 <font class="keywordflow">continue</font>;
00295             }
00296             <font class="comment">/*</font>
00297              * use column verification 
00298              */
00299             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m4">valid_columns</a>) {
00300                 tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> =
00301                     <a class="code" href="ttest_8c.html#a3">closest_column</a>(var-&gt;name[oid_column_pos],
00302                                    tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m4">valid_columns</a>);
00303                 <font class="keywordflow">if</font> (tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> == 0)
00304                     <font class="keywordflow">continue</font>;
00305                 <font class="keywordflow">if</font> (tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> != var-&gt;name[oid_column_pos]) {
00306                     <font class="comment">/*</font>
00307                      * different column! truncate useless index info 
00308                      */
00309                     var-&gt;name_length = oid_column_pos;
00310                 }
00311             }
00312             <font class="comment">/*</font>
00313              * var-&gt;name_length may have changed - check again 
00314              */
00315             <font class="keywordflow">if</font> (var-&gt;name_length &lt;= oid_column_pos) { 
00316                 tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> = 0;
00317             } <font class="keywordflow">else</font> {
00318                 tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> = var-&gt;name[oid_column_pos];
00319                 tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> =
00320                     var-&gt;name_length - oid_index_pos;
00321                 assert(tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> &lt; MAX_OID_LEN);
00322                 memcpy(tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>, &amp;var-&gt;name[oid_index_pos],
00323                        tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> * <font class="keyword">sizeof</font>(oid));
00324                 tmp_name = tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>;
00325             }
00326         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) {
00327             table_helper_cleanup(reqinfo, request, SNMP_ERR_NOSUCHNAME);
00328             <font class="keywordflow">continue</font>;
00329         } <font class="keywordflow">else</font> {
00330             tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> = 0;
00331             tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a> = tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m2">min_column</a>;
00332         }
00333 
00334         <font class="keywordflow">if</font> (tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a> == 0) {
00335             incomplete = 1;
00336             tmp_len = -1;
00337         } <font class="keywordflow">else</font>
00338             tmp_len = tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a>;
00339 
00340 
00341         <font class="comment">/*</font>
00342          * for each index type, try to extract the index from var-&gt;name
00343          */
00344 
00345         <font class="keywordflow">for</font> (tmp_idx = 0, vb = tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>;
00346              tmp_idx &lt; tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m1">number_indexes</a>;
00347              ++tmp_idx, vb = vb-&gt;next_variable) {
00348             <font class="keywordflow">if</font> (incomplete &amp;&amp; tmp_len) {
00349                 <font class="comment">/*</font>
00350                  * incomplete/illegal OID, set up dummy 0 to parse 
00351                  */
00352                 DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>,
00353                             <font class="stringliteral">"  oid indexes not complete.\n"</font>));
00354                 <font class="comment">/*</font>
00355                  * no sense in trying anymore if this is a GET/SET. 
00356                  */
00357                 <font class="keywordflow">if</font> (reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) {
00358                     table_helper_cleanup(reqinfo, requests,
00359                                          SNMP_ERR_NOSUCHNAME);
00360                 }
00361                 tmp_len = 0;
00362                 tmp_name = (oid *) &amp; tmp_len;
00363             }
00364             <font class="comment">/*</font>
00365              * try and parse current index 
00366              */
00367             <font class="keywordflow">if</font> (parse_one_oid_index(&amp;tmp_name, &amp;tmp_len,
00368                                     vb, 1) != SNMPERR_SUCCESS)<font class="keyword"> </font>{
00369                 incomplete = 1;
00370                 tmp_len = -1;   <font class="comment">/* is this necessary? Better safe than</font>
00371                                  * sorry */
00372             } <font class="keywordflow">else</font> {
00373                 <font class="comment">/*</font>
00374                  * do not count incomplete indexes 
00375                  */
00376                 <font class="keywordflow">if</font> (incomplete)
00377                     <font class="keywordflow">continue</font>;
00378                 ++tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m1">number_indexes</a>; 
00379                 <font class="keywordflow">if</font> (tmp_len &lt;= 0) {
00380                     incomplete = 1;
00381                     tmp_len = -1;       <font class="comment">/* is this necessary? Better safe</font>
00382                                          * than sorry */
00383                 }
00384             }
00385         }                       
00388         <font class="comment">/*</font>
00389          * do we have sufficent index info to continue?
00390          */
00391 
00392         <font class="keywordflow">if</font> ((reqinfo-&gt;<a class="code" href="structagent__request__info__s.html#m0">mode</a> != <a class="code" href="snmp__agent_8h.html#a5">MODE_GETNEXT</a>) &amp;&amp;
00393             ((tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m1">number_indexes</a> != tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m1">number_indexes</a>) ||
00394              (tmp_len != -1))) {
00395             table_helper_cleanup(reqinfo, request, SNMP_ERR_NOSUCHNAME);
00396         }
00397 
00398         DEBUGIF(<font class="stringliteral">"helper:table"</font>)<font class="keyword"> </font>{
00399             <font class="keywordtype">int</font>             count;
00400             <font class="keywordtype">char</font>            buf[SPRINT_MAX_LEN];
00401             DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>, <font class="stringliteral">"  column: %d, indexes: %d\n"</font>,
00402                         tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m0">colnum</a>,
00403                         tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m1">number_indexes</a>));
00404             <font class="keywordflow">for</font> (vb = tbl_req_info-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>, count = 0;
00405                  vb &amp;&amp; count &lt; tbl_info-&gt;<a class="code" href="struct__table__registration__info.html#m1">number_indexes</a>;
00406                  count++, vb = vb-&gt;next_variable) {
00407                 sprint_by_type(buf, vb, 0, 0, 0);
00408                 DEBUGMSGTL((<font class="stringliteral">"helper:table"</font>,
00409                             <font class="stringliteral">"    index: type=%d, value=%s\n"</font>, vb-&gt;type,
00410                             buf));
00411             }
00412         }
00413 
00414         <font class="comment">/*</font>
00415          * save table_req_info 
00416          */
00417         <a class="code" href="helpers_2agent__handler_8h.html#a23">request_add_list_data</a>(request,
00418                               create_data_list(<a class="code" href="table_8h.html#a0">TABLE_HANDLER_NAME</a>,
00419                                                (<font class="keywordtype">void</font> *) tbl_req_info,
00420                                                <a class="code" href="table_8c.html#a2">table_data_free_func</a>));
00421 
00422     }                           <font class="comment">/* for each request */</font>
00423 
00424 
00425     <font class="comment">/*</font>
00426      * * call our child access function 
00427      */
00428     <font class="keywordflow">if</font> (need_processing)
00429         status = <a class="code" href="helpers_2agent__handler_8h.html#a18">call_next_handler</a>(handler, reginfo, reqinfo, requests);
00430 
00431     <font class="keywordflow">return</font> status;
00432 }
</pre></div>    </td>
  </tr>
</table>
<a name="a10" doxytag="table.c::update_indexes_from_variable_list"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int update_indexes_from_variable_list </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>tri</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00517">517</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00518 {
00519     <font class="keywordflow">return</font> build_oid_noalloc(tri-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>, <font class="keyword">sizeof</font>(tri-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>),
00520                              &amp;tri-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a>, NULL, 0, tri-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>);
00521 }
</pre></div>    </td>
  </tr>
</table>
<a name="a9" doxytag="table.c::update_variable_list_from_index"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int update_variable_list_from_index </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap><a class="el" href="table_8h.html#a12">table_request_info</a> *&nbsp;</td>
          <td class="mdname1">&nbsp; <em>tri</em>          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="table_8c-source.html#l00510">510</a> of file <a class="el" href="table_8c-source.html">table.c</a>.<div class="fragment"><pre>00511 {
00512     <font class="keywordflow">return</font> parse_oid_indexes(tri-&gt;<a class="code" href="struct__table__request__info.html#m3">index_oid</a>, tri-&gt;<a class="code" href="struct__table__request__info.html#m4">index_oid_len</a>,
00513                              tri-&gt;<a class="code" href="struct__table__request__info.html#m2">indexes</a>);
00514 }
</pre></div>    </td>
  </tr>
</table>
<hr><address><small>Generated on Sat Nov 10 14:09:56 2001 for net-snmp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
<!--#include virtual="/sfbutton.html" -->
<!--#include virtual="/sfbutton.html" -->
<!-- CONTENT END -->