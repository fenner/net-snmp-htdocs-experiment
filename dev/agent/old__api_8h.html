---
section: development
---
<!-- CONTENT START -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>old_api.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>old_api.h File Reference</h1>
<p>
<a href="old__api_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="structold__api__info__s.html">old_api_info_s</a></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="structold__opi__cache__s.html">old_opi_cache_s</a></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td nowrap align=right valign=top>#define&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a0">OLD_API_NAME</a>&nbsp;&nbsp;&nbsp;"old_api"</td></tr>
<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td nowrap align=right valign=top>typedef <a class="el" href="structold__api__info__s.html">old_api_info_s</a>&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a1">old_api_info</a></td></tr>
<tr><td nowrap align=right valign=top>typedef <a class="el" href="structold__opi__cache__s.html">old_opi_cache_s</a>&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a2">old_api_cache</a></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a4">register_old_api</a> (const char *moduleName, struct <a class="el" href="structvariable.html">variable</a> *var, size_t varsize, size_t numvars, oid *mibloc, size_t mibloclen, int priority, int range_subid, oid range_ubound, struct snmp_session *ss, const char *context, int timeout, int flags)</td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structagent__snmp__session.html">agent_snmp_session</a> *&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a5">get_current_agent_session</a> (void)</td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top>NodeHandler&nbsp;</td><td valign=bottom><a class="el" href="old__api_8h.html#a3">old_api_helper</a></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a name="a0" doxytag="old_api.h::OLD_API_NAME"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OLD_API_NAME&nbsp;&nbsp;&nbsp;"old_api"
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8h-source.html#l00004">4</a> of file <a class="el" href="old__api_8h-source.html">old_api.h</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a name="a2" doxytag="old_api.h::old_api_cache"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="structold__opi__cache__s.html">old_opi_cache_s</a>  old_api_cache
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a name="a1" doxytag="old_api.h::old_api_info"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="structold__api__info__s.html">old_api_info_s</a>  old_api_info
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a5" doxytag="old_api.h::get_current_agent_session"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structagent__snmp__session.html">agent_snmp_session</a>* get_current_agent_session </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>void&nbsp;</td>
          <td class="mdname1">&nbsp;          </td>
          <td class="md">)&nbsp;</td>
          <td class="md"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00022">22</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.<div class="fragment"><pre>00022                             {
00023     <font class="keywordflow">return</font> current_agent_session;
00024 }
</pre></div>    </td>
  </tr>
</table>
<a name="a4" doxytag="old_api.h::register_old_api"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int register_old_api </td>
          <td class="md">(&nbsp;</td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>moduleName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structvariable.html">variable</a> *&nbsp;</td>
          <td class="mdname">&nbsp; <em>var</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>varsize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>numvars</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>oid *&nbsp;</td>
          <td class="mdname">&nbsp; <em>mibloc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname">&nbsp; <em>mibloclen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>priority</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>range_subid</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>oid&nbsp;</td>
          <td class="mdname">&nbsp; <em>range_ubound</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct snmp_session *&nbsp;</td>
          <td class="mdname">&nbsp; <em>ss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname">&nbsp; <em>context</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>timeout</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname">&nbsp; <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8c-source.html#l00038">38</a> of file <a class="el" href="old__api_8c-source.html">old_api.c</a>.
<p>
Referenced by <a class="el" href="agent__registry_8c-source.html#l00481">register_mib_context</a>().
<p>
<div class="fragment"><pre>00050                             {
00051     
00052     <a class="code" href="structold__api__info__s.html">old_api_info</a> *old_info = SNMP_MALLOC_TYPEDEF(<a class="code" href="structold__api__info__s.html">old_api_info</a>);
00053     <font class="keywordtype">int</font> i;
00054     
00055     old_info-&gt;<a class="code" href="structold__api__info__s.html#m0">var</a> = var;
00056     old_info-&gt;<a class="code" href="structold__api__info__s.html#m1">varsize</a> = varsize;
00057     old_info-&gt;<a class="code" href="structold__api__info__s.html#m2">numvars</a> = numvars;
00058     old_info-&gt;<a class="code" href="structold__api__info__s.html#m3">ss</a> = ss;
00059     old_info-&gt;<a class="code" href="structold__api__info__s.html#m4">flags</a> = flags;
00060     
00061     <font class="comment">/* register all subtree nodes */</font>
00062     <font class="keywordflow">for</font>(i = 0; i &lt; numvars; i++) {
00063         <font class="keyword">struct </font><a class="code" href="structvariable.html">variable</a> *vp;
00064         <a class="code" href="structhandler__registration__s.html">handler_registration</a> *reginfo =
00065             SNMP_MALLOC_TYPEDEF(<a class="code" href="structhandler__registration__s.html">handler_registration</a>);
00066 
00067         memdup((<font class="keywordtype">void</font> *) &amp;vp,
00068                (<font class="keywordtype">void</font> *) (<font class="keyword">struct</font> <a class="code" href="structvariable.html">variable</a> *) ((<font class="keywordtype">char</font> *) var + varsize*i),
00069                varsize);
00070  
00071         reginfo-&gt;handler = <a class="code" href="old__api_8c.html#a4">get_old_api_handler</a>();
00072         reginfo-&gt;handlerName = strdup(moduleName);
00073         reginfo-&gt;rootoid_len = (mibloclen + vp-&gt;<a class="code" href="structvariable.html#m4">namelen</a>);
00074         reginfo-&gt;rootoid =
00075             (oid *) malloc(reginfo-&gt;rootoid_len * <font class="keyword">sizeof</font>(oid));
00076         
00077         memcpy(reginfo-&gt;rootoid, mibloc, mibloclen*<font class="keyword">sizeof</font>(oid));
00078         memcpy(reginfo-&gt;rootoid + mibloclen, vp-&gt;<a class="code" href="structvariable.html#m5">name</a>, vp-&gt;<a class="code" href="structvariable.html#m4">namelen</a>
00079                * <font class="keyword">sizeof</font>(oid));
00080         reginfo-&gt;handler-&gt;myvoid = (<font class="keywordtype">void</font> *) vp;
00081 
00082         reginfo-&gt;priority = priority;
00083         reginfo-&gt;range_subid = range_subid;
00084         
00085         reginfo-&gt;range_ubound = range_ubound;
00086         reginfo-&gt;timeout = timeout;
00087         reginfo-&gt;contextName = (context) ? strdup(context) : NULL;
00088         reginfo-&gt;modes = HANDLER_CAN_RWRITE;
00089 
00090         <font class="comment">/* register ourselves in the mib tree */</font>
00091         <a class="code" href="helpers_2agent__handler_8h.html#a12">register_handler</a>(reginfo);
00092     }
00093     <font class="keywordflow">return</font> SNMPERR_SUCCESS;
00094 }
</pre></div>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a3" doxytag="old_api.h::old_api_helper"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NodeHandler old_api_helper
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="old__api_8h-source.html#l00034">34</a> of file <a class="el" href="old__api_8h-source.html">old_api.h</a>.    </td>
  </tr>
</table>
<hr><address><small>Generated on Sat Nov 10 14:09:55 2001 for net-snmp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
<!--#include virtual="/sfbutton.html" -->
<!--#include virtual="/sfbutton.html" -->
<!-- CONTENT END -->